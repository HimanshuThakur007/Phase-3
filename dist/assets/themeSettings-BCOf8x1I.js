import{P as PropTypes,u as useFetch,r as renderField,t as toCsv,j as jsxRuntimeExports,a as useDispatch,b as useLocation,c as useParams,s as setLoading,d as setError,e as setSummaries,f as setDepartmentSummaries,g as setItemSummaries,h as setComparisonSummaries,i as setBranchSchemeSummaries,k as clearData,l as fetchStart,m as fetchSuccess,n as fetchFailure,o as fetchDashboardData,L as Link,I as ImageWithBasePath}from"./index-lKAf_eBp.js";import{a as reactExports,R as React,u as useForm,f as useWatch}from"./react-hook-form-Bavd7xdc.js";function _extends$2(){_extends$2=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};return _extends$2.apply(this,arguments)}function _objectWithoutProperties$2(source,excluded){if(null==source)return{};var target=_objectWithoutPropertiesLoose$2(source,excluded),key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];excluded.indexOf(key)>=0||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}}return target}function _objectWithoutPropertiesLoose$2(source,excluded){if(null==source)return{};var target={},sourceKeys=Object.keys(source),key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];excluded.indexOf(key)>=0||(target[key]=source[key])}return target}var ChevronDown=reactExports.forwardRef(function(_ref,ref){var _ref$color=_ref.color,color=void 0===_ref$color?"currentColor":_ref$color,_ref$size=_ref.size,size=void 0===_ref$size?24:_ref$size,rest=_objectWithoutProperties$2(_ref,["color","size"]);return React.createElement("svg",_extends$2({ref:ref,xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},rest),React.createElement("polyline",{points:"6 9 12 15 18 9"}))});ChevronDown.propTypes={color:PropTypes.string,size:PropTypes.oneOfType([PropTypes.string,PropTypes.number])};ChevronDown.displayName="ChevronDown";function _extends$1(){_extends$1=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};return _extends$1.apply(this,arguments)}function _objectWithoutProperties$1(source,excluded){if(null==source)return{};var target=_objectWithoutPropertiesLoose$1(source,excluded),key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];excluded.indexOf(key)>=0||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}}return target}function _objectWithoutPropertiesLoose$1(source,excluded){if(null==source)return{};var target={},sourceKeys=Object.keys(source),key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];excluded.indexOf(key)>=0||(target[key]=source[key])}return target}var ChevronUp=reactExports.forwardRef(function(_ref,ref){var _ref$color=_ref.color,color=void 0===_ref$color?"currentColor":_ref$color,_ref$size=_ref.size,size=void 0===_ref$size?24:_ref$size,rest=_objectWithoutProperties$1(_ref,["color","size"]);return React.createElement("svg",_extends$1({ref:ref,xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},rest),React.createElement("polyline",{points:"18 15 12 9 6 15"}))});ChevronUp.propTypes={color:PropTypes.string,size:PropTypes.oneOfType([PropTypes.string,PropTypes.number])};ChevronUp.displayName="ChevronUp";function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};return _extends.apply(this,arguments)}function _objectWithoutProperties(source,excluded){if(null==source)return{};var target=_objectWithoutPropertiesLoose(source,excluded),key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];excluded.indexOf(key)>=0||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}}return target}function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var target={},sourceKeys=Object.keys(source),key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];excluded.indexOf(key)>=0||(target[key]=source[key])}return target}var Settings=reactExports.forwardRef(function(_ref,ref){var _ref$color=_ref.color,color=void 0===_ref$color?"currentColor":_ref$color,_ref$size=_ref.size,size=void 0===_ref$size?24:_ref$size,rest=_objectWithoutProperties(_ref,["color","size"]);return React.createElement("svg",_extends({ref:ref,xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},rest),React.createElement("circle",{cx:"12",cy:"12",r:"3"}),React.createElement("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}))});Settings.propTypes={color:PropTypes.string,size:PropTypes.oneOfType([PropTypes.string,PropTypes.number])};Settings.displayName="Settings";const useBranchesApi=()=>{const callFetch=useFetch(),[branches,setBranches]=reactExports.useState([]),[loadingBranches,setLoadingBranches]=reactExports.useState(!1),[branchesError,setBranchesError]=reactExports.useState(null),[states,setStates]=reactExports.useState([]),[loadingStates,setLoadingStates]=reactExports.useState(!1),[statesError,setStatesError]=reactExports.useState(null),[dropdowns,setDropdowns]=reactExports.useState({Global_HBT:[],Local_HBT:[],Sales_Bucket:[],Stock_Bucket:[],Transit_Qty:[],Local_Import:[]}),[loadingDropdowns,setLoadingDropdowns]=reactExports.useState(!1),[dropdownsError,setDropdownsError]=reactExports.useState(null),fetchBranches=reactExports.useCallback(async(force=!1)=>{if(!force&&branches.length>0)return branches;setLoadingBranches(!0);setBranchesError(null);try{const result=await callFetch("get-branches","GET"),payload=result.got;if(!payload){setBranches([]);setBranchesError("No response payload");return[]}if("error"===payload.status){setBranches([]);setBranchesError(payload.message||"Server returned error");return[]}const data=Array.isArray(payload.data)?payload.data:[],mapped=data.filter(b=>b&&null!=b.value&&null!=b.label).map(b=>({value:b.value,label:String(b.label)}));setBranches(mapped);return mapped}catch(err){console.error("Error fetching branches:",err);setBranches([]);setBranchesError((null==err?void 0:err.message)||"Failed to load branches");return[]}finally{setLoadingBranches(!1)}},[callFetch,branches]),fetchStates=reactExports.useCallback(async(force=!1,stateFilter)=>{if(!force&&states.length>0&&!stateFilter)return states;setLoadingStates(!0);setStatesError(null);try{const url=stateFilter?`get-states?state=${encodeURIComponent(stateFilter)}`:"get-states",result=await callFetch(url,"GET"),payload=result.got;if(!payload){setStates([]);setStatesError("No response payload");return[]}if("error"===payload.status){setStates([]);setStatesError(payload.message||"Server returned error");return[]}const data=Array.isArray(payload.data)?payload.data:[],mapped=data.filter(s=>s&&null!=s.value&&null!=s.label).map(s=>({value:s.value,label:String(s.label)}));stateFilter&&!force||setStates(mapped);return mapped}catch(err){console.error("Error fetching states:",err);setStates([]);setStatesError((null==err?void 0:err.message)||"Failed to load states");return[]}finally{setLoadingStates(!1)}},[callFetch,states]),fetchDropdowns=reactExports.useCallback(async(force=!1)=>{const isCached=Object.values(dropdowns).some(arr=>arr.length>0);if(!force&&isCached)return dropdowns;setLoadingDropdowns(!0);setDropdownsError(null);try{const result=await callFetch("hbt-dropdowns","GET"),payload=result.got;if(!payload||"ok"!==payload.status){setDropdownsError((null==payload?void 0:payload.status)||"No response payload");return dropdowns}const validDropdowns={Global_HBT:[],Local_HBT:[],Sales_Bucket:[],Stock_Bucket:[],Transit_Qty:[],Local_Import:[]};Object.entries(payload.dropdowns).forEach(([key,items])=>{if(!(key in validDropdowns)||!Array.isArray(items))return;const dropdownKey=key;let filteredItems=items.filter(item=>null!=item&&null!=item.value&&null!=item.label);if("Transit_Qty"===dropdownKey)filteredItems=filteredItems.filter(item=>"string"==typeof item.value).map(item=>({value:String(item.value).trim(),label:String(item.label).trim()}));else if("Local_Import"===dropdownKey)filteredItems=filteredItems.filter(item=>"string"==typeof item.value&&""!==item.value.trim()).map(item=>({value:String(item.value).trim(),label:String(item.label).trim()}));else if("Sales_Bucket"===dropdownKey){const excludeLabels=["6 to 10 Qty","Greater Than 10 Qty"];filteredItems=filteredItems.filter(item=>!excludeLabels.includes(String(item.label).trim())).map(item=>({value:String(item.value).trim(),label:String(item.label).trim()}))}else filteredItems=filteredItems.map(item=>({value:String(item.value).trim(),label:String(item.label).trim()}));validDropdowns[dropdownKey]=filteredItems});console.log("Valid Dropdowns:",validDropdowns);setDropdowns(validDropdowns);return validDropdowns}catch(err){console.error("Error fetching dropdowns:",err);setDropdownsError((null==err?void 0:err.message)||"Failed to load dropdowns");return dropdowns}finally{setLoadingDropdowns(!1)}},[callFetch,dropdowns]),fetchAll=reactExports.useCallback(async options=>{const force=(null==options?void 0:options.force)??!1;setBranchesError(null);setStatesError(null);setDropdownsError(null);setLoadingBranches(!0);setLoadingStates(!0);setLoadingDropdowns(!0);try{const[branchesRes,statesRes,dropdownsRes]=await Promise.allSettled([fetchBranches(force),fetchStates(force),fetchDropdowns(force)]),result={branches:branches,states:states,dropdowns:dropdowns};"fulfilled"===branchesRes.status&&(result.branches=branchesRes.value);"fulfilled"===statesRes.status&&(result.states=statesRes.value);"fulfilled"===dropdownsRes.status&&(result.dropdowns=dropdownsRes.value);return result}finally{setLoadingBranches(!1);setLoadingStates(!1);setLoadingDropdowns(!1)}},[fetchBranches,fetchStates,fetchDropdowns,branches,states,dropdowns]);return{branches:branches,loadingBranches:loadingBranches,branchesError:branchesError,fetchBranches:fetchBranches,states:states,loadingStates:loadingStates,statesError:statesError,fetchStates:fetchStates,dropdowns:dropdowns,loadingDropdowns:loadingDropdowns,dropdownsError:dropdownsError,fetchDropdowns:fetchDropdowns,fetchAll:fetchAll}},p3Filter={properties:{stockBucket:{type:"string",description:"stockBucket",component:"InputSelect",props:{name:"stockBucket",label:"Stock Bucket",required:!1,isMulti:!0,isClearable:!0}},saleBucket:{type:"string",description:"saleBucket",component:"InputSelect",props:{name:"saleBucket",label:"Sales Bucket",required:!1,isMulti:!0,isClearable:!0}},transitQty:{type:"string",description:"transitQty",component:"InputSelect",props:{name:"transitQty",label:"Transit Qty",required:!1,isMulti:!0,isClearable:!0}},localHbtClass:{type:"string",description:"localHbtClass",component:"InputSelect",props:{name:"localHbtClass",label:"Local HBT Class",required:!1,isMulti:!0,isClearable:!0}},globalHbtClass:{type:"string",description:"globalHbtClass",component:"InputSelect",props:{name:"globalHbtClass",label:"Global HBT Class",required:!1,isMulti:!0,isClearable:!0}},localimport:{type:"string",description:"localimport",component:"InputSelect",props:{name:"localimport",label:"Local Import",required:!1,isMulti:!0,isClearable:!0}},states:{type:"string",description:"states",component:"InputSelect",props:{name:"states",label:"State",required:!1,isMulti:!0,isClearable:!0}},branches:{type:"string",description:"branches",component:"InputSelect",props:{name:"branches",label:"Branch Name",required:!1,isMulti:!0,isClearable:!0}}}},BASE_DEFAULT_FILTERS={branches:null,states:null,stockBucket:[{value:"121-150 Days",label:"121-150 Days"},{value:"151-180 Days",label:"151-180 Days"},{value:"181-360 Days",label:"181-360 Days"},{value:"91-120 Days",label:"91-120 Days"},{value:"360+ Days",label:"360+ Days"}],saleBucket:[{value:"0 Qty",label:"0 Qty"}],transitQty:[{value:"0",label:"0"}],localimport:null,localHbtClass:null,globalHbtClass:null},STORAGE_KEY_PREFIX="phase3-filter-",loadPersisted=field=>{try{const raw=sessionStorage.getItem(STORAGE_KEY_PREFIX+field);if(!raw)return null;const parsed=JSON.parse(raw);return Array.isArray(parsed)&&parsed.length>0?parsed:null}catch{return null}},savePersisted=(field,value)=>{try{const isEmpty=null==value||Array.isArray(value)&&0===value.length,key=STORAGE_KEY_PREFIX+field;isEmpty?sessionStorage.removeItem(key):sessionStorage.setItem(key,JSON.stringify(value));try{window.dispatchEvent(new Event("phase3-filters-updated"))}catch{}}catch{}},useReportFilters=(extraDefaultValues={})=>{const{branches:branches,states:states,fetchAll:fetchAll,dropdowns:dropdowns}=useBranchesApi(),persistedDefaults=reactExports.useMemo(()=>{const fields=["branches","states","stockBucket","saleBucket","transitQty","localHbtClass","globalHbtClass","localimport"],defaults={...BASE_DEFAULT_FILTERS};fields.forEach(f=>{const stored=loadPersisted(f);if(null!==stored)defaults[f]=stored;else if(null!=BASE_DEFAULT_FILTERS[f]){savePersisted(f,BASE_DEFAULT_FILTERS[f]);defaults[f]=BASE_DEFAULT_FILTERS[f]}});return defaults},[]),form=useForm({mode:"onBlur",defaultValues:{...BASE_DEFAULT_FILTERS,...persistedDefaults,...extraDefaultValues}});reactExports.useEffect(()=>{fetchAll()},[fetchAll]);reactExports.useEffect(()=>{const subscription=form.watch((value,{name:name})=>{if(!name)return;const field=name,val=value[field];savePersisted(field,val)});return()=>subscription.unsubscribe()},[form]);const watchedValues=useWatch({control:form.control})||{},selectOptions=reactExports.useMemo(()=>({branches:branches,states:states,stockBucket:dropdowns.Stock_Bucket||[],saleBucket:dropdowns.Sales_Bucket||[],transitQty:dropdowns.Transit_Qty||[],localHbtClass:dropdowns.Local_HBT||[],globalHbtClass:dropdowns.Global_HBT||[],localimport:dropdowns.Local_Import||[]}),[branches,states,dropdowns]),renderFieldWrapper=reactExports.useCallback((field,key)=>{var _a;return renderField({field:field,form:form,options:(null==(_a=field.props)?void 0:_a.name)&&selectOptions[field.props.name]||[],key:key})},[form,selectOptions]),buildPayload=reactExports.useCallback(data=>({branchCode:toCsv(data.branches)||"",state:toCsv(data.states)||"",Local_HBT:toCsv(data.localHbtClass)||"",Global_HBT:toCsv(data.globalHbtClass)||"",Stock_Bucket:toCsv(data.stockBucket)||"",Sales_Bucket:toCsv(data.saleBucket)||"",Transit_Qty:toCsv(data.transitQty)||"",Local_Import:toCsv(data.localimport)||"",...data}),[]),onSubmit=reactExports.useCallback(cb=>raw=>{const payload=buildPayload(raw);cb(payload)},[buildPayload]),selectedFiltersSummary=reactExports.useMemo(()=>{const summary=[],config=[{key:"branches",label:"Branches",options:branches},{key:"states",label:"States",options:states},{key:"stockBucket",label:"Stock Bucket",options:dropdowns.Stock_Bucket||[]},{key:"saleBucket",label:"Sales Bucket",options:dropdowns.Sales_Bucket||[]},{key:"transitQty",label:"Transit Qty",options:dropdowns.Transit_Qty||[]},{key:"localHbtClass",label:"Local HBT",options:dropdowns.Local_HBT||[]},{key:"globalHbtClass",label:"Global HBT",options:dropdowns.Global_HBT||[]},{key:"localimport",label:"Local Import",options:dropdowns.Local_Import||[]}],resolveLabel=(item,options)=>{if(null==item)return null;if("string"==typeof item||"number"==typeof item){const s=String(item),opt=options.find(o=>String(o.value)===s||String(o.label)===s);return(null==opt?void 0:opt.label)??s}if("object"==typeof item){if(item.label)return item.label;if(item.value){const s=String(item.value),opt=options.find(o=>String(o.value)===s||String(o.label)===s);return(null==opt?void 0:opt.label)??s}return String(item)}return String(item)};config.forEach(({key:key,label:label,options:options})=>{const rawSelected=null==watchedValues?void 0:watchedValues[key];let selected=rawSelected;(null==selected||Array.isArray(selected)&&0===selected.length)&&(null==persistedDefaults?void 0:persistedDefaults[key])&&(selected=persistedDefaults[key]);(null==selected||Array.isArray(selected)&&0===selected.length)&&(null==BASE_DEFAULT_FILTERS?void 0:BASE_DEFAULT_FILTERS[key])&&(selected=BASE_DEFAULT_FILTERS[key]);if(!selected||Array.isArray(selected)&&0===selected.length)return;const labels=Array.isArray(selected)?selected.map(v=>resolveLabel(v,options)).filter(Boolean):[resolveLabel(selected,options)].filter(Boolean);labels.length>0&&summary.push({label:label,values:labels})});return summary},[watchedValues,branches,states,dropdowns,persistedDefaults]),clearAllFilters=reactExports.useCallback(()=>{form.reset(BASE_DEFAULT_FILTERS);Object.keys(BASE_DEFAULT_FILTERS).forEach(field=>sessionStorage.removeItem(STORAGE_KEY_PREFIX+field));Object.entries(BASE_DEFAULT_FILTERS).forEach(([k,v])=>{const key=k;null==v||Array.isArray(v)&&0===v.length||savePersisted(key,v)});window.dispatchEvent(new Event("phase3-filters-updated"))},[form]);return{form:form,selectOptions:selectOptions,renderFieldWrapper:renderFieldWrapper,onSubmit:onSubmit,selectedFiltersSummary:selectedFiltersSummary,clearAllFilters:clearAllFilters,ReportFilterRowProps:{properties:p3Filter.properties,renderField:renderFieldWrapper}}},ReportFilterRow=({properties:properties,renderField:renderField2,onSubmit:onSubmit})=>{const handleClick=e=>{e.preventDefault();null==onSubmit||onSubmit()};return jsxRuntimeExports.jsxs("div",{className:"row g-3 mb-2",children:[Object.entries(properties).map(([key,field])=>jsxRuntimeExports.jsx("div",{className:"col-lg-12 col-md-12 col-sm-12",children:renderField2(field,key)},key)),jsxRuntimeExports.jsx("div",{className:"col-lg-12 col-md-12 col-sm-12 d-flex align-items-center d-none",children:jsxRuntimeExports.jsx("button",{type:"submit",className:"btn btn-primary w-100 mt-lg-4",onClick:handleClick,children:"Show Report"})})]})};function c(e,u,c2,i){var a=this,o=reactExports.useRef(null),f=reactExports.useRef(0),l=reactExports.useRef(0),v=reactExports.useRef(null),m=reactExports.useRef([]),d=reactExports.useRef(),g=reactExports.useRef(),p=reactExports.useRef(e),w=reactExports.useRef(!0);p.current=e;var s="undefined"!=typeof window,x=!u&&0!==u&&s;if("function"!=typeof e)throw new TypeError("Expected a function");u=+u||0;var h=!!(c2=c2||{}).leading,y=!("trailing"in c2)||!!c2.trailing,F="maxWait"in c2,A="debounceOnServer"in c2&&!!c2.debounceOnServer,D=F?Math.max(+c2.maxWait||0,u):null;reactExports.useEffect(function(){return w.current=!0,function(){w.current=!1}},[]);var T=reactExports.useMemo(function(){var r=function(r2){var n2=m.current,t2=d.current;return m.current=d.current=null,f.current=r2,l.current=l.current||r2,g.current=p.current.apply(t2,n2)},n=function(r2,n2){x&&cancelAnimationFrame(v.current),v.current=x?requestAnimationFrame(r2):setTimeout(r2,n2)},t=function(r2){if(!w.current)return!1;var n2=r2-o.current;return!o.current||n2>=u||n2<0||F&&r2-f.current>=D},e2=function(n2){return v.current=null,y&&m.current?r(n2):(m.current=d.current=null,g.current)},c3=function r2(){var c4=Date.now();if(h&&l.current===f.current&&T2(),t(c4))return e2(c4);if(w.current){var i2=u-(c4-o.current),a2=F?Math.min(i2,D-(c4-f.current)):i2;n(r2,a2)}},T2=function(){},W=function(){if(s||A){var e3=Date.now(),i2=t(e3);if(m.current=[].slice.call(arguments),d.current=a,o.current=e3,i2){if(!v.current&&w.current)return f.current=o.current,n(c3,u),h?r(o.current):g.current;if(F)return n(c3,u),r(o.current)}return v.current||n(c3,u),g.current}};return W.cancel=function(){var r2=v.current;r2&&(x?cancelAnimationFrame(v.current):clearTimeout(v.current)),f.current=0,m.current=o.current=d.current=v.current=null},W.isPending=function(){return!!v.current},W.flush=function(){return v.current?e2(Date.now()):g.current},W},[h,F,u,D,y,x,s,A,i]);return T}const ThemeSettings=()=>{var _a,_b,_c;const dispatch=useDispatch(),callFetch=useFetch(),location=useLocation(),{id:id}=useParams(),[show,setShow]=reactExports.useState(!1),[openSection,setOpenSection]=reactExports.useState(null);reactExports.useEffect(()=>{const saved=localStorage.getItem("openThemeSection");setOpenSection(saved??"filters")},[]);reactExports.useEffect(()=>{openSection?localStorage.setItem("openThemeSection",openSection):localStorage.removeItem("openThemeSection")},[openSection]);const toggleSection=section=>{setOpenSection(prev=>prev===section?null:section)},getInitialTheme=()=>{const storedTheme=localStorage.getItem("colorschema");if(storedTheme)return storedTheme;const prefersDark=window.matchMedia("(prefers-color-scheme: dark)").matches;return prefersDark?"dark_mode":"light_mode"},[layoutColor,setLayoutColor]=reactExports.useState(getInitialTheme()),[layoutView,setLayoutView]=reactExports.useState(localStorage.getItem("layoutStyling")||"default"),[layoutTheme,setLayoutTheme]=reactExports.useState(localStorage.getItem("layoutThemeColors")||"light"),pathname=location.pathname,basePath=pathname.split("/")[1]||"",selectedDepartment=(null==(_a=location.state)?void 0:_a.department)??"",selectedBranch=(null==(_b=location.state)?void 0:_b.branchCode)??"",itemCode=(null==(_c=location.state)?void 0:_c.itemCode)??"",{enable:enable,bucket:bucket}=(null==location?void 0:location.state)??{};console.log("searching loc",enable,bucket);const{form:form,onSubmit:onFilterSubmit,ReportFilterRowProps:ReportFilterRowProps}=useReportFilters(),buildPayload=reactExports.useCallback(()=>{const values=form.getValues(),basePayload={branchCode:toCsv(values.branches)||"",state:toCsv(values.states)||"",Local_HBT:toCsv(values.localHbtClass)||"",Global_HBT:toCsv(values.globalHbtClass)||"",Stock_Bucket:1===enable?bucket:toCsv(values.stockBucket)||"",Sales_Bucket:toCsv(values.saleBucket)||"",Transit_Qty:toCsv(values.transitQty)||"",Local_Import:toCsv(values.localimport)||""};console.log("basePayload",basePayload);return"dynamictable"===basePath&&id?{...basePayload,department:selectedDepartment||"",branchCode:selectedBranch||basePayload.branchCode,itemCode:itemCode||""}:basePayload},[form,basePath,id,selectedDepartment,selectedBranch,itemCode]),fetchData=reactExports.useCallback(async payload=>{var _a2;dispatch(setLoading(!0));dispatch(setError(null));dispatch(setSummaries([]));dispatch(setDepartmentSummaries([]));dispatch(setItemSummaries([]));dispatch(setComparisonSummaries([]));dispatch(setBranchSchemeSummaries([]));try{const[branchRes,deptRes,itemRes,comparisonRes,branchSchemeRes]=await Promise.all([callFetch("hbt-summary","POST",payload).catch(()=>({got:null})),callFetch("hbt-summary-department","POST",payload).catch(()=>({got:null})),callFetch("hbt-summary-item","POST",payload).catch(()=>({got:null})),callFetch("hbt-summary-item-schemes","POST",payload).catch(()=>({got:null})),callFetch("hbt-summary-branch-schemes","POST",payload).catch(()=>({got:null}))]),branches="ok"===(null==(_a2=branchRes.got)?void 0:_a2.status)&&branchRes.got.summaries||[];dispatch(setSummaries(branches));const deptData=deptRes.got,deptArr=Array.isArray(deptData)?deptData:(null==deptData?void 0:deptData.departments)??(null==deptData?void 0:deptData.department_summaries)??("ok"===(null==deptData?void 0:deptData.status)&&(deptData.summaries||deptData.data)||[]);dispatch(setDepartmentSummaries(deptArr));const itemData=itemRes.got,itemArr=Array.isArray(itemData)?itemData:"ok"===(null==itemData?void 0:itemData.status)&&itemData.summaries||[];dispatch(setItemSummaries(itemArr));const comparisonData=comparisonRes.got;if("ok"===(null==comparisonData?void 0:comparisonData.status)&&Array.isArray(comparisonData.summaries))dispatch(setComparisonSummaries(comparisonData.summaries));else if("ok"===(null==comparisonData?void 0:comparisonData.status)&&comparisonData.data){const arr=Array.isArray(comparisonData.data)?comparisonData.data:[];dispatch(setComparisonSummaries(arr))}else dispatch(setComparisonSummaries([]));const branchSchemeData=branchSchemeRes.got;if("ok"===(null==branchSchemeData?void 0:branchSchemeData.status)){const summaries=Array.isArray(branchSchemeData.summaries)?branchSchemeData.summaries:branchSchemeData.data&&Array.isArray(branchSchemeData.data)?branchSchemeData.data:[];dispatch(setBranchSchemeSummaries(summaries))}else dispatch(setBranchSchemeSummaries([]))}catch(e){const msg=(null==e?void 0:e.message)||"Failed to load data";dispatch(setError(msg));console.error("fetchData error:",msg,e)}finally{dispatch(setLoading(!1))}},[callFetch,dispatch]),fetchDetail=reactExports.useCallback(async payload=>{dispatch(clearData());dispatch(fetchStart());console.log("Functions running");try{const{got:got}=await callFetch("get-hbtsync-data","POST",{branchCode:selectedBranch||payload.branchCode||"",department:selectedDepartment||payload.department||"",itemCode:itemCode||payload.itemCode||"",...payload});let processed=[];const safeNumber=v=>{if(null==v||""===v)return null;if("number"==typeof v)return Number.isFinite(v)?v:null;const s=String(v).replace(/,/g,"").trim();if(""===s)return null;const n=Number(s);return Number.isFinite(n)?n:null},FIELD_MAP={},extractField=(obj,canonical)=>{const candidates=FIELD_MAP[canonical]??[canonical];if(!obj)return null;for(const k of candidates)if(Object.prototype.hasOwnProperty.call(obj,k))return obj[k];const lower=canonical.toLowerCase();for(const k of Object.keys(obj))if(k.toLowerCase()===lower)return obj[k];return null},normalizeItem=(it,parentBranch)=>{const normalized={Item_Code:extractField(it,"Item_Code"),Item_Name:extractField(it,"Item_Name"),Department:extractField(it,"Department"),category:extractField(it,"category"),subcategory:extractField(it,"subcategory"),description:extractField(it,"description"),Branch_Code:extractField(it,"Branch_Code")??(parentBranch?extractField(parentBranch,"Branch_Code"):null),Branch_Name:extractField(it,"Branch_Name")??(parentBranch?extractField(parentBranch,"Branch_Name"):null),state:extractField(it,"state"),item_status:extractField(it,"item_status")??extractField(it,"status"),exp_imp_sur:extractField(it,"exp_imp_sur"),Site_Qtys:safeNumber(extractField(it,"Site_Qtys")),Total_Sale_Qty:safeNumber(extractField(it,"Total_Sale_Qty")),Total_Sale_Val:safeNumber(extractField(it,"Total_Sale_Val")),Local_HBT_Class:extractField(it,"Local_HBT_Class"),Global_HBT_Class:extractField(it,"Global_HBT_Class"),Stock_Remarks:extractField(it,"Stock_Remarks"),Stock_Days_Diff:safeNumber(extractField(it,"Stock_Days_Diff")),Stock_Bucket:extractField(it,"Stock_Bucket"),Sales_Bucket:extractField(it,"Sales_Bucket"),Str_Stk_Sp_Value:safeNumber(extractField(it,"Str_Stk_Sp_Value")),Tax_Per_Qty:safeNumber(extractField(it,"Tax_Per_Qty")),Mrgn_Per_Qty:safeNumber(extractField(it,"Mrgn_Per_Qty")),Ttl_Mrgn:safeNumber(extractField(it,"Ttl_Mrgn")),scheme_type:extractField(it,"scheme_type"),scheme_group:extractField(it,"scheme_group"),balance_bin_stock:safeNumber(extractField(it,"balance_bin_stock")),po_qty:safeNumber(extractField(it,"po_qty"))};return normalized},extractItemsFromBranch=b=>{if(!b)return[];if(Array.isArray(b.items))return b.items;if(Array.isArray(b.Items))return b.Items;if(Array.isArray(b.ITEMS))return b.ITEMS;if(Array.isArray(b.ItemsList))return b.ItemsList;if(Array.isArray(b.itemsList))return b.itemsList;const hasItemCode=b&&(b.Item_Code||b.item_code||b.ItemCode||b["Item Code"]||b.itemCode);return hasItemCode?[b]:[]},parseCodes=raw=>raw?Array.isArray(raw)?raw.map(x=>String(x??"").trim()).filter(Boolean).map(s=>s.toLowerCase()):String(raw).split(",").map(s=>s.trim()).filter(Boolean).map(s=>s.toLowerCase()):[],filterCodes=parseCodes(itemCode??(null==payload?void 0:payload.itemCode)??(null==got?void 0:got.applied_itemCode)??null),isBranchedFlow="1"===id||"2"===id;if(isBranchedFlow){const branches=Array.isArray(got)?got:(null==got?void 0:got.branches)??(null==got?void 0:got.departments)??(null==got?void 0:got.summaries)??(null==got?void 0:got.items)??(Array.isArray(got.items)?got.items:[]),allItems=(branches||[]).flatMap(branch=>{const rawItems=extractItemsFromBranch(branch);return rawItems.map(item=>normalizeItem(item,branch))});processed=filterCodes.length>0?allItems.filter(it=>filterCodes.includes(String(it.Item_Code??"").trim().toLowerCase())):allItems}else{const rawItems=Array.isArray(got)?got:(null==got?void 0:got.departments)??(null==got?void 0:got.department_summaries)??(null==got?void 0:got.items)??(null==got?void 0:got.summaries)??[],arr=Array.isArray(rawItems)?rawItems:[],normalized=arr.map(it=>normalizeItem(it));processed=filterCodes.length>0?normalized.filter(it=>filterCodes.includes(String(it.Item_Code??"").trim().toLowerCase())):normalized}dispatch(fetchSuccess(processed))}catch(e){dispatch(fetchFailure((null==e?void 0:e.message)??"Failed to load detail data"))}},[callFetch,dispatch,id,selectedBranch,selectedDepartment,itemCode]),triggerFetch=reactExports.useCallback(()=>{const payload=buildPayload();if("dynamictable"===basePath)fetchDetail(payload);else if("summaries"===basePath)fetchData(payload);else if(""===basePath){dispatch(fetchDashboardData(payload));fetchData(payload)}},[basePath,buildPayload,fetchData,fetchDetail]),debouncedTriggerFetch=c(triggerFetch,500);reactExports.useEffect(()=>{debouncedTriggerFetch()},[debouncedTriggerFetch,basePath,id]);const handleFilterSubmit=form.handleSubmit(values=>{onFilterSubmit(values);console.log("vvvvvvv",values);debouncedTriggerFetch()});reactExports.useEffect(()=>{document.documentElement.setAttribute("data-layout-mode",layoutColor);document.documentElement.setAttribute("data-layout-style",layoutView);document.documentElement.setAttribute("data-nav-color",layoutTheme);localStorage.setItem("colorschema",layoutColor)},[layoutColor,layoutView,layoutTheme]);const applyTheme=(theme,userOverride=!1)=>{setLayoutColor(theme);localStorage.setItem("colorschema",theme);userOverride&&localStorage.setItem("userThemeOverride","true");dispatch({type:"SET_THEME",payload:theme});document.documentElement.setAttribute("data-layout-mode",theme)};reactExports.useEffect(()=>{const mediaQuery=window.matchMedia("(prefers-color-scheme: dark)"),handleChange=e=>{localStorage.getItem("userThemeOverride")||applyTheme(e.matches?"dark_mode":"light_mode")};if(!localStorage.getItem("userThemeOverride")){const initial=mediaQuery.matches?"dark_mode":"light_mode";layoutColor!==initial&&applyTheme(initial)}mediaQuery.addEventListener("change",handleChange);return()=>mediaQuery.removeEventListener("change",handleChange)},[layoutColor]);const showSettings=e=>{e.preventDefault();setShow(prev=>!prev)},darkThemes=()=>applyTheme("dark_mode",!0),lightThemes=()=>applyTheme("light_mode",!0),resetData=e=>{e.preventDefault();localStorage.removeItem("colorschema");localStorage.removeItem("layoutStyling");localStorage.removeItem("layoutThemeColors");localStorage.removeItem("userThemeOverride");localStorage.removeItem("openThemeSection");const mediaQuery=window.matchMedia("(prefers-color-scheme: dark)"),initialTheme=mediaQuery.matches?"dark_mode":"light_mode";setLayoutColor(initialTheme);setLayoutView("default");setLayoutTheme("light");applyTheme(initialTheme);document.documentElement.setAttribute("data-layout-style","default");document.documentElement.setAttribute("data-nav-color","light");setOpenSection("filters")};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"customizer-links",id:"setdata",children:jsxRuntimeExports.jsx("ul",{className:"sticky-sidebar",children:jsxRuntimeExports.jsx("li",{className:"sidebar-icons",onClick:showSettings,children:jsxRuntimeExports.jsx(Link,{to:"#",onClick:e=>e.preventDefault(),className:"navigation-add","data-bs-toggle":"tooltip","data-bs-placement":"left",title:"Theme & Filters",children:jsxRuntimeExports.jsx(Settings,{className:"feather-five"})})})})}),jsxRuntimeExports.jsx("div",{className:"sidebar-settings nav-toggle "+(show?"show-settings":""),id:"layoutDiv",children:jsxRuntimeExports.jsxs("div",{className:"sidebar-content sticky-sidebar-one",children:[jsxRuntimeExports.jsxs("div",{className:"sidebar-header",children:[jsxRuntimeExports.jsxs("div",{className:"sidebar-theme-title",children:[jsxRuntimeExports.jsx("h5",{children:"Theme & Filters"}),jsxRuntimeExports.jsx("p",{children:"Customize theme and apply report filters"})]}),jsxRuntimeExports.jsxs("div",{className:"close-sidebar-icon d-flex",children:[jsxRuntimeExports.jsx(Link,{to:"#",className:"sidebar-refresh me-2",onClick:resetData,title:"Reset",children:"âŸ³"}),jsxRuntimeExports.jsx(Link,{className:"sidebar-close",to:"#",onClick:e=>{e.preventDefault();setShow(!1)},children:"X"})]})]}),jsxRuntimeExports.jsxs("div",{className:"sidebar-body p-0",children:[jsxRuntimeExports.jsxs("form",{children:[jsxRuntimeExports.jsxs("div",{className:"theme-mode mb-3",children:[jsxRuntimeExports.jsxs("div",{className:"theme-head d-flex justify-content-between align-items-center cursor-pointer p-3 border-bottom",onClick:()=>toggleSection("filters"),children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h6",{children:"Report Filters"}),jsxRuntimeExports.jsx("p",{className:"mb-0",children:"Filter data across all reports"})]}),"filters"===openSection?jsxRuntimeExports.jsx(ChevronUp,{size:18}):jsxRuntimeExports.jsx(ChevronDown,{size:18})]}),"filters"===openSection&&jsxRuntimeExports.jsx("div",{className:"p-3 border-bottom",children:jsxRuntimeExports.jsx(ReportFilterRow,{...ReportFilterRowProps,onSubmit:handleFilterSubmit})})]}),jsxRuntimeExports.jsxs("div",{className:"theme-mode mb-0",children:[jsxRuntimeExports.jsxs("div",{className:"theme-head d-flex justify-content-between align-items-center cursor-pointer p-3 border-bottom",onClick:()=>toggleSection("theme"),children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h6",{children:"Theme Settings"}),jsxRuntimeExports.jsx("p",{className:"mb-0",children:"Light & Dark modes, navigation colors"})]}),"theme"===openSection?jsxRuntimeExports.jsx(ChevronUp,{size:18}):jsxRuntimeExports.jsx(ChevronDown,{size:18})]}),"theme"===openSection&&jsxRuntimeExports.jsx("div",{className:"p-3",children:jsxRuntimeExports.jsxs("div",{className:"row mb-3",children:[jsxRuntimeExports.jsx("div",{className:"col-xl-6",children:jsxRuntimeExports.jsx("div",{className:"layout-wrap",children:jsxRuntimeExports.jsx("div",{className:"d-flex align-items-center",children:jsxRuntimeExports.jsxs("div",{className:"status-toggle d-flex align-items-center me-2",onClick:lightThemes,children:[jsxRuntimeExports.jsx("input",{type:"radio",name:"theme-mode",id:"light_mode",className:"check",checked:"light_mode"===layoutColor,onChange:lightThemes}),jsxRuntimeExports.jsxs("label",{htmlFor:"light_mode",className:"checktoggles",children:[jsxRuntimeExports.jsx(ImageWithBasePath,{src:"assets/light.png",alt:"Light"}),jsxRuntimeExports.jsx("span",{className:"theme-name",children:"Light Mode"})]})]})})})}),jsxRuntimeExports.jsx("div",{className:"col-xl-6",children:jsxRuntimeExports.jsx("div",{className:"layout-wrap",children:jsxRuntimeExports.jsx("div",{className:"d-flex align-items-center",children:jsxRuntimeExports.jsxs("div",{className:"status-toggle d-flex align-items-center me-2",onClick:darkThemes,children:[jsxRuntimeExports.jsx("input",{type:"radio",name:"theme-mode",id:"dark_mode",className:"check",checked:"dark_mode"===layoutColor,onChange:darkThemes}),jsxRuntimeExports.jsxs("label",{htmlFor:"dark_mode",className:"checktoggles",children:[jsxRuntimeExports.jsx(ImageWithBasePath,{src:"assets/dark.png",alt:"Dark"}),jsxRuntimeExports.jsx("span",{className:"theme-name",children:"Dark Mode"})]})]})})})})]})})]})]}),jsxRuntimeExports.jsx("div",{className:"sidebar-footer p-3",children:jsxRuntimeExports.jsxs("div",{className:"row g-2",children:[jsxRuntimeExports.jsx("div",{className:"col-6",children:jsxRuntimeExports.jsxs("button",{type:"button",className:"btn btn-primary w-100 d-flex align-items-center justify-content-center gap-2",onClick:triggerFetch,"data-bs-toggle":"tooltip","data-bs-placement":"top",title:"Apply filters and reload reports",children:[jsxRuntimeExports.jsx(Settings,{size:16}),"Show Reports"]})}),jsxRuntimeExports.jsx("div",{className:"col-6",children:jsxRuntimeExports.jsx("button",{type:"button",className:"btn btn-secondary w-100",onClick:resetData,children:"Reset to System Default"})})]})})]})]})})]})};export{ThemeSettings as default};
//# sourceMappingURL=themeSettings-BCOf8x1I.js.map
