{"version":3,"file":"DynamicTable-DG1x85xe.js","sources":["../../src/feature-modules/phase3/useSchemeOptions.ts","../../src/feature-modules/phase3/DynamicTable.tsx"],"sourcesContent":["// api/useSchemeOptions.ts\nimport { useCallback } from \"react\";\nimport useFetch from \"../../hooks/useFetch\";\n\nexport interface Option {\n  label: string;\n  value: number;\n}\n\ninterface ApiResponse<T = Option[]> {\n  status: \"ok\" | \"error\";\n  total: number;\n  data: T;\n}\n\nconst useSchemeOptions = () => {\n  const fetcher = useFetch();\n\n  // Fetch all scheme types\n  const getSchemeTypes = useCallback(async (): Promise<ApiResponse<Option[]> | null> => {\n    try {\n      const { got } = await fetcher<ApiResponse<Option[]>>(\"get-scheme-types\", \"GET\");\n      return got ?? null;\n    } catch {\n      return null;\n    }\n  }, [fetcher]);\n\n  // Fetch scheme groups by selected schemeTypeId\n  const getSchemeGroups = useCallback(\n    async (schemeTypeId: number): Promise<ApiResponse<Option[]> | null> => {\n      if (!schemeTypeId) return null;\n      try {\n        const { got } = await fetcher<ApiResponse<Option[]>>(\n          `get-scheme-groups/${schemeTypeId}`,\n          \"GET\"\n        );\n        \n        return got;\n      } catch {\n        return null;\n      }\n    },\n    [fetcher]\n  );\n\n  return {\n    getSchemeTypes,\n    getSchemeGroups,\n  };\n};\n\nexport default useSchemeOptions;","// import React, { useCallback, useEffect, useMemo, useState } from \"react\";\n// import { useLocation, useNavigate, useParams } from \"react-router-dom\";\n// import Wrapper from \"../../common/uicomponent/wrapper\";\n// import GridTable from \"../../common/component/GridTable\";\n// import { toTitleCase } from \"./helperfunc\";\n// import { useSelector, useDispatch } from \"react-redux\";\n// import CenteredLoader from \"../../common/component/CenteredLoader\";\n// import { FormProvider, useForm } from \"react-hook-form\";\n// import { renderField } from \"../../common/utils/renderField\";\n// import scheme, { display } from \"../../core/json/scheme\";\n// import useSchemeOptions, { Option } from \"./useSchemeOptions\";\n// import { saveScheme } from \"../../redux/phase3Slice\";\n\n// const SimpleModal: React.FC<{\n//   show: boolean;\n//   title: string;\n//   size?: \"sm\" | \"md\" | \"lg\" | \"xl\";\n//   onClose: () => void;\n//   footer?: React.ReactNode;\n//   children?: React.ReactNode;\n// }> = ({ show, title, size = \"md\", onClose, footer, children }) => {\n//   if (!show) return null;\n//   const dlgClass =\n//     size === \"sm\"\n//       ? \"modal-sm\"\n//       : size === \"lg\"\n//       ? \"modal-lg\"\n//       : size === \"xl\"\n//       ? \"modal-xl\"\n//       : \"\";\n//   return (\n//     <div\n//       className=\"modal fade show d-block\"\n//       style={{ backgroundColor: \"rgba(0,0,0,0.5)\" }}\n//       tabIndex={-1}\n//     >\n//       <div className={`modal-dialog ${dlgClass} modal-dialog-centered`}>\n//         <div className=\"modal-content\">\n//           <div className=\"modal-header\">\n//             <h5 className=\"modal-title\">{title}</h5>\n//             <button\n//               type=\"button\"\n//               className=\"btn-close\"\n//               onClick={onClose}\n//               aria-label=\"Close\"\n//             />\n//           </div>\n//           <div className=\"modal-body\">{children}</div>\n//           {footer && <div className=\"modal-footer\">{footer}</div>}\n//         </div>\n//       </div>\n//     </div>\n//   );\n// };\n\n// const Pase3DynamicTable: React.FC = () => {\n//   const { id } = useParams();\n//   const location = useLocation();\n//   const navigate = useNavigate();\n//   const dispatch = useDispatch();\n\n//   const savedSchemes = useSelector((s: any) => s.phase3.savedSchemes ?? []);\n\n//   const selectedDepartment = (location.state as any)?.department ?? \"\";\n//   const selectedBranch = (location.state as any)?.branchCode ?? \"\";\n//   const itemCodeFromState = (location.state as any)?.itemCode ?? \"\";\n\n//   const {\n//     data: detailData = [],\n//     loading,\n//     error,\n//   } = useSelector(\n//     (state: any) =>\n//       state.reportDetail || { data: [], loading: false, error: null }\n//   );\n\n//   const [tableHeight, setTableHeight] = useState(\"550px\");\n//   const { getSchemeTypes, getSchemeGroups } = useSchemeOptions();\n\n//   const [schemeTypes, setSchemeTypes] = useState<Option[]>([]);\n//   const [schemeGroups, setSchemeGroups] = useState<Option[]>([]);\n//   const [loadingTypes, setLoadingTypes] = useState(true);\n//   const [loadingGroups, setLoadingGroups] = useState(false);\n\n//   // selection state for grid\n//   const [selectedRows, setSelectedRows] = useState<any[]>([]);\n//   const selectedRowsHandler = (data: any) => setSelectedRows(data || []);\n\n//   // local modal state (non-redux)\n//   const [modalOpen, setModalOpen] = useState(false);\n//   const [modalType, setModalType] = useState<null | \"scheme\" | \"display\">(null);\n\n//   const form = useForm<any>({\n//     mode: \"onBlur\",\n//     defaultValues: {\n//       startDate: null,\n//       endDate: null,\n//       schemeType: null,\n//       schemeGroup: null,\n//       displayType: null,\n//     },\n//   });\n//   const defaultFormValues = {\n//     startDate: null,\n//     endDate: null,\n//     schemeType: null,\n//     schemeGroup: null,\n//     displayType: null,\n//   };\n\n//   const selectedSchemeType = form.watch(\"schemeType\");\n\n//   // load types on mount\n//   useEffect(() => {\n//     let mounted = true;\n//     const load = async () => {\n//       setLoadingTypes(true);\n//       try {\n//         const res = await getSchemeTypes();\n//         if (mounted && res?.status === \"ok\") setSchemeTypes(res.data || []);\n//       } catch (e) {\n//         console.error(\"getSchemeTypes\", e);\n//       } finally {\n//         if (mounted) setLoadingTypes(false);\n//       }\n//     };\n//     load();\n//     return () => {\n//       mounted = false;\n//     };\n//   }, [getSchemeTypes]);\n\n//   useEffect(() => {\n//     if (!selectedSchemeType) {\n//       setSchemeGroups([]);\n//       try {\n//         form.setValue(\"schemeGroup\", null);\n//       } catch {}\n//       return;\n//     }\n//     let mounted = true;\n//     const load = async () => {\n//       setLoadingGroups(true);\n//       try {\n//         const value = selectedSchemeType.value;\n//         const res = await getSchemeGroups(value);\n//         if (mounted && res?.status === \"ok\") setSchemeGroups(res.data || []);\n//       } catch (e) {\n//         console.error(\"getSchemeGroups\", e);\n//         if (mounted) setSchemeGroups([]);\n//       } finally {\n//         if (mounted) setLoadingGroups(false);\n//         try {\n//           form.setValue(\"schemeGroup\", null);\n//         } catch {}\n//       }\n//     };\n//     load();\n//     return () => {\n//       mounted = false;\n//     };\n//   }, [selectedSchemeType, getSchemeGroups, form]);\n\n//   const selectOptions = useMemo(\n//     () => ({\n//       schemeType: schemeTypes,\n//       schemeGroup: schemeGroups,\n//       displayType: [\n//         { value: \"Send Shelf Picture\", label: \"Send Shelf Picture\" },\n//       ],\n//     }),\n//     [schemeTypes, schemeGroups]\n//   );\n\n//   const renderFieldWrapper = useCallback(\n//     (field: any, key: string) =>\n//       renderField({\n//         field,\n//         form,\n//         options: field.props?.name\n//           ? selectOptions[field.props.name as keyof typeof selectOptions] || []\n//           : [],\n//         key,\n//       }),\n//     [form, selectOptions]\n//   );\n\n//   // helpers\n//   const getItemCodeFromRow = useCallback((row: any): string | undefined => {\n//     if (!row) return undefined;\n//     const raw =\n//       row?.[\"Item Code\"] ??\n//       row?.itemCode ??\n//       row?.ItemCode ??\n//       row?.item_code ??\n//       row?.Item_Code ??\n//       row?.itemcode ??\n//       undefined;\n//     if (raw === undefined || raw === null) return undefined;\n//     const trimmed = String(raw).trim();\n//     return trimmed === \"\" ? undefined : trimmed;\n//   }, []);\n\n//   const getBranchCodeFromRow = useCallback(\n//     (row: any): string | undefined => {\n//       if (selectedBranch && String(selectedBranch).trim() !== \"\") {\n//         return String(selectedBranch).trim();\n//       }\n//       if (!row) return undefined;\n//       const raw =\n//         row?.branchCode ??\n//         row?.Branch_Code ??\n//         row?.BranchCode ??\n//         row?.branch_code ??\n//         row?.branch ??\n//         row?.Branch ??\n//         undefined;\n//       if (raw === undefined || raw === null) return undefined;\n//       const trimmed = String(raw).trim();\n//       return trimmed === \"\" ? undefined : trimmed;\n//     },\n//     [selectedBranch]\n//   );\n\n//   const findSavedEntryForRow = useCallback(\n//     (row: any) => {\n//       const itemCode = getItemCodeFromRow(row);\n//       const branchCode = getBranchCodeFromRow(row);\n//       if (itemCode) {\n//         if (branchCode) {\n//           return savedSchemes.find(\n//             (s: any) =>\n//               String(s.itemCode ?? \"\")\n//                 .trim()\n//                 .toLowerCase() === String(itemCode).trim().toLowerCase() &&\n//               String(s.branchCode ?? \"\")\n//                 .trim()\n//                 .toLowerCase() === String(branchCode).trim().toLowerCase()\n//           );\n//         }\n//         const global = savedSchemes.find(\n//           (s: any) =>\n//             String(s.itemCode ?? \"\")\n//               .trim()\n//               .toLowerCase() === String(itemCode).trim().toLowerCase() &&\n//             (s.branchCode === undefined || s.branchCode === null)\n//         );\n//         return global;\n//       }\n//       try {\n//         const rowJson = JSON.stringify(row || {});\n//         return savedSchemes.find((s: any) => {\n//           try {\n//             return JSON.stringify(s.data) === rowJson;\n//           } catch {\n//             return false;\n//           }\n//         });\n//       } catch {\n//         return undefined;\n//       }\n//     },\n//     [savedSchemes, getItemCodeFromRow, getBranchCodeFromRow]\n//   );\n\n//   // totals\n//   const totals = useMemo(() => {\n//     if (!detailData?.length) {\n//       return {\n//         totalSiteQty: 0,\n//         totalSaleQty: 0,\n//         totalSaleVal: 0,\n//         totalStockValue: 0,\n//       };\n//     }\n//     return detailData.reduce(\n//       (acc: any, row: any) => {\n//         const siteQty = row.total_site_qty ?? row.Site_Qtys ?? 0;\n//         acc.totalSiteQty += typeof siteQty === \"number\" ? siteQty : 0;\n//         const saleQty = row.Total_Sale_Qty ?? row.total_sale_qty ?? 0;\n//         acc.totalSaleQty += typeof saleQty === \"number\" ? saleQty : 0;\n//         const saleVal = row.Total_Sale_Val ?? row.total_sale_val ?? 0;\n//         acc.totalSaleVal += typeof saleVal === \"number\" ? saleVal : 0;\n//         const stockVal =\n//           row.Str_Stk_Sp_Value ??\n//           row.str_stk_sp_value ??\n//           row.total_str_stk_sp_value ??\n//           0;\n//         acc.totalStockValue += typeof stockVal === \"number\" ? stockVal : 0;\n//         return acc;\n//       },\n//       { totalSiteQty: 0, totalSaleQty: 0, totalSaleVal: 0, totalStockValue: 0 }\n//     );\n//   }, [detailData]);\n\n//   // base columns\n//   const baseColumnDefs = useMemo(() => {\n//     if (!detailData?.length) return [];\n//     const first = detailData[0];\n//     const keys = Object.keys(first);\n//     const seen = new Set<string>();\n//     return keys\n//       .filter((k) => {\n//         const lower = k.toLowerCase();\n//         if (\n//           lower.includes(\"item\") &&\n//           (lower.includes(\"code\") || lower.includes(\"name\"))\n//         ) {\n//           if (seen.has(\"item_code\") || seen.has(\"item_name\")) return false;\n//           if (lower.includes(\"code\")) seen.add(\"item_code\");\n//           if (lower.includes(\"name\")) seen.add(\"item_name\");\n//         }\n//         return true;\n//       })\n//       .map((k) => ({\n//         field: k,\n//         headerName: toTitleCase(k),\n//         filter:\n//           typeof first[k] === \"string\"\n//             ? \"agTextColumnFilter\"\n//             : \"agNumberColumnFilter\",\n//         headerClass: \"bg-royal-blue text-white\",\n//         sortable: true,\n//         resizable: true,\n//       }));\n//   }, [detailData]);\n\n//   // displayed columns\n//   const displayedColumnDefs = useMemo(() => {\n//     const cols: any = [...baseColumnDefs];\n\n//     // checkbox only for item view and only for rows that DON'T have an applied scheme\n//     if (id === \"2\") {\n//       const hasCheckboxAlready = cols.some(\n//         (c: any) => c.field === \"__select__\" || c.checkboxSelection\n//       );\n//       if (!hasCheckboxAlready) {\n//         const checkboxCol = {\n//           field: \"__select__\",\n//           headerName: \"\",\n//           width: 48,\n//           pinned: \"left\",\n//           lockPosition: true,\n//           suppressSizeToFit: true,\n//           sortable: false,\n//           filter: false,\n//           resizable: false,\n//           // show checkbox only when the row does NOT have an applied scheme\n//           checkboxSelection: (params: any) => {\n//             try {\n//               const row = params.data;\n//               const saved = findSavedEntryForRow(row);\n//               return !saved?.data?.appliedScheme;\n//             } catch (e) {\n//               return true;\n//             }\n//           },\n//           // disable header checkbox because not all rows are selectable\n//           headerCheckboxSelection: false,\n//           cellRenderer: (params: any) => null,\n//         };\n//         cols.unshift(checkboxCol);\n//       }\n//     }\n\n//     // Per request: removed Scheme and Display columns from the table\n//     return cols;\n//   }, [baseColumnDefs, id, findSavedEntryForRow]);\n\n//   // responsive height\n//   useEffect(() => {\n//     const calculateTableHeight = () => {\n//       const windowHeight = window.innerHeight;\n//       const windowWidth = window.innerWidth;\n//       const headerHeight = 100;\n//       const footerHeight = 30;\n//       const bottomSpace = 50;\n//       const minHeight = 400;\n//       const tabletMinWidth = 768;\n//       const tabletMaxWidth = 1024;\n//       let calculatedHeight: number;\n\n//       if (windowWidth >= 1200) {\n//         calculatedHeight =\n//           windowHeight - headerHeight - footerHeight - bottomSpace;\n//       } else if (\n//         windowWidth >= tabletMinWidth &&\n//         windowWidth <= tabletMaxWidth\n//       ) {\n//         const tabletAdjustment = windowWidth < 900 ? 150 : 100;\n//         calculatedHeight =\n//           windowHeight - headerHeight - footerHeight - tabletAdjustment;\n//       } else {\n//         calculatedHeight = windowHeight - headerHeight - footerHeight - 100;\n//       }\n\n//       setTableHeight(`${Math.max(calculatedHeight, minHeight)}px`);\n//     };\n\n//     calculateTableHeight();\n//     window.addEventListener(\"resize\", calculateTableHeight);\n//     window.addEventListener(\"orientationchange\", calculateTableHeight);\n//     return () => {\n//       window.removeEventListener(\"resize\", calculateTableHeight);\n//       window.removeEventListener(\"orientationchange\", calculateTableHeight);\n//     };\n//   }, []);\n\n//   // drilldown\n//   const handleDrillDown = (e: any) => {\n//     if (id === \"2\") return;\n//     const code =\n//       e?.data?.Item_Code ?? e?.data?.item_code ?? e?.data?.[\"Item Code\"] ?? \"\";\n//     if (code) navigate(\"/dynamictable/2\", { state: { itemCode: code } });\n//   };\n\n//   const heading = selectedDepartment\n//     ? `Department: ${selectedDepartment}`\n//     : selectedBranch\n//     ? `Branch: ${selectedBranch}`\n//     : `ItemCode: ${itemCodeFromState}`;\n\n//   // --------------------------\n//   // modal save handlers (bulk apply)\n//   // --------------------------\n//   const saveSchemeForSelected = (data: any) => {\n//     const targets = selectedRows.length ? selectedRows : []; // if no selection, nothing happens\n//     targets.forEach((row: any) => {\n//       const existing = findSavedEntryForRow(row);\n//       const existingData = existing?.data ?? {};\n//       const schemeToSave = {\n//         ...(existingData.appliedDisplay\n//           ? { appliedDisplay: existingData.appliedDisplay }\n//           : {}),\n//         appliedScheme: data,\n//       };\n//       dispatch(\n//         saveScheme({\n//           row: {\n//             ...row,\n//             itemCode: getItemCodeFromRow(row),\n//             branchCode: getBranchCodeFromRow(row),\n//           },\n//           scheme: schemeToSave,\n//         })\n//       );\n//     });\n//     setModalOpen(false);\n//     setModalType(null);\n//     try {\n//       form.reset(defaultFormValues);\n//     } catch {}\n//   };\n\n//   const saveDisplayForSelected = (data: any) => {\n//     const targets = selectedRows.length ? selectedRows : [];\n//     targets.forEach((row: any) => {\n//       const existing = findSavedEntryForRow(row);\n//       const existingData = existing?.data ?? {};\n//       const schemeToSave = {\n//         ...(existingData.appliedScheme\n//           ? { appliedScheme: existingData.appliedScheme }\n//           : {}),\n//         appliedDisplay: data,\n//       };\n//       dispatch(\n//         saveScheme({\n//           row: {\n//             ...row,\n//             itemCode: getItemCodeFromRow(row),\n//             branchCode: getBranchCodeFromRow(row),\n//           },\n//           scheme: schemeToSave,\n//         })\n//       );\n//     });\n//     setModalOpen(false);\n//     setModalType(null);\n//     try {\n//       form.reset(defaultFormValues);\n//     } catch {}\n//   };\n\n//   // bulk open handlers (above table)\n//   const openApplySchemeBulk = () => {\n//     if (!selectedRows.length) return;\n//     const preset =\n//       selectedRows.length === 1\n//         ? findSavedEntryForRow(selectedRows[0])?.data?.appliedScheme ?? null\n//         : null;\n//     setModalType(\"scheme\");\n//     try {\n//       form.reset(defaultFormValues);\n//       if (preset) form.reset(preset);\n//     } catch {}\n//     setModalOpen(true);\n//   };\n\n//   const openApplyDisplayBulk = () => {\n//     if (!selectedRows.length) return;\n//     const preset =\n//       selectedRows.length === 1\n//         ? findSavedEntryForRow(selectedRows[0])?.data?.appliedDisplay ?? null\n//         : null;\n//     setModalType(\"display\");\n//     try {\n//       form.reset(defaultFormValues);\n//       if (preset) form.reset(preset);\n//     } catch {}\n//     setModalOpen(true);\n//   };\n\n//   const SchemeModalBody = (\n//     <FormProvider {...form}>\n//       <form onSubmit={form.handleSubmit(saveSchemeForSelected)}>\n//         <div className=\"mb-3 small text-muted\">\n//           Applying scheme to {selectedRows.length} selected row\n//           {selectedRows.length > 1 ? \"s\" : \"\"}.\n//         </div>\n//         <div className=\"row\">\n//           {Object.entries(scheme.properties).map(([key, field]) => (\n//             <div key={key} className=\"col-lg-6 col-md-6 mb-3\">\n//               {renderFieldWrapper(field as any, key)}\n//             </div>\n//           ))}\n//         </div>\n//       </form>\n//     </FormProvider>\n//   );\n\n//   const DisplayModalBody = (\n//     <FormProvider {...form}>\n//       <form onSubmit={form.handleSubmit(saveDisplayForSelected)}>\n//         <div className=\"mb-3 small text-muted\">\n//           Applying display to {selectedRows.length} selected row\n//           {selectedRows.length > 1 ? \"s\" : \"\"}.\n//         </div>\n//         <div className=\"row\">\n//           {Object.entries(display.properties).map(([key, field]) => (\n//             <div key={key} className=\"col-lg-12 col-md-12 mb-3\">\n//               {renderFieldWrapper(field as any, key)}\n//             </div>\n//           ))}\n//         </div>\n//       </form>\n//     </FormProvider>\n//   );\n\n//   const modalFooter =\n//     modalType === \"scheme\" ? (\n//       <>\n//         <button\n//           type=\"button\"\n//           className=\"btn btn-secondary\"\n//           onClick={() => {\n//             setModalOpen(false);\n//             setModalType(null);\n//             try {\n//               form.reset(defaultFormValues);\n//             } catch {}\n//           }}\n//         >\n//           Close\n//         </button>\n//         <button\n//           type=\"button\"\n//           className=\"btn btn-primary\"\n//           onClick={() => form.handleSubmit(saveSchemeForSelected)()}\n//         >\n//           Save\n//         </button>\n//       </>\n//     ) : modalType === \"display\" ? (\n//       <>\n//         <button\n//           type=\"button\"\n//           className=\"btn btn-secondary\"\n//           onClick={() => {\n//             setModalOpen(false);\n//             setModalType(null);\n//             try {\n//               form.reset(defaultFormValues);\n//             } catch {}\n//           }}\n//         >\n//           Close\n//         </button>\n//         <button\n//           type=\"button\"\n//           className=\"btn btn-primary\"\n//           onClick={() => form.handleSubmit(saveDisplayForSelected)()}\n//         >\n//           Save\n//         </button>\n//       </>\n//     ) : null;\n\n//   // render\n//   return (\n//     <Wrapper\n//       header={`Phase 3 – ${heading}`}\n//       subHeader=\"Detail Report\"\n//       ExportR={1}\n//       backButtonName=\"Back\"\n//     >\n//       <>\n//         {loading && <CenteredLoader />}\n//         {error && <div className=\"alert alert-danger\">{error}</div>}\n\n//         {!loading && !error && (\n//           <>\n//             {/* Top bulk controls only for item-level (id===2) */}\n//             {id === \"2\" && (\n//               <div className=\"d-flex gap-2 mb-2 align-items-center\">\n//                 <div className=\"small text-muted me-2\">\n//                   Selected: <strong>{selectedRows.length}</strong>\n//                 </div>\n//                 <button\n//                   type=\"button\"\n//                   className=\"btn btn-sm btn-outline-primary\"\n//                   disabled={selectedRows.length === 0}\n//                   onClick={openApplySchemeBulk}\n//                 >\n//                   Apply Scheme\n//                 </button>\n//                 <button\n//                   type=\"button\"\n//                   className=\"btn btn-sm btn-outline-secondary\"\n//                   disabled={selectedRows.length === 0}\n//                   onClick={openApplyDisplayBulk}\n//                 >\n//                   Apply Display\n//                 </button>\n//               </div>\n//             )}\n\n//             {/* Summary Badges */}\n//             {detailData.length > 0 && (\n//               <div className=\"d-flex flex-wrap gap-2 mb-1 align-items-center\">\n//                 {Object.entries({\n//                   \"Site Qty\": totals.totalSiteQty,\n//                   \"Sale Qty\": totals.totalSaleQty,\n//                   \"Sale Value\": totals.totalSaleVal,\n//                   \"Sp Value\": totals.totalStockValue,\n//                 }).map(([label, value]) => {\n//                   const cleanValue = Math.floor(Number(value));\n//                   const displayValue = cleanValue.toLocaleString(\"en-IN\");\n//                   return (\n//                     <span\n//                       key={label}\n//                       className=\"badge bg-light text-dark border px-3 py-2 fw-medium\"\n//                       style={{ fontSize: \"0.875rem\" }}\n//                       title={label}\n//                     >\n//                       <strong>{label}:</strong> {displayValue}\n//                     </span>\n//                   );\n//                 })}\n//               </div>\n//             )}\n\n//             {/* Table */}\n//             {detailData.length > 0 ? (\n//               <GridTable\n//                 rowData={detailData}\n//                 columnDefs={displayedColumnDefs}\n//                 enableEditing={false}\n//                 enableSelection={id === \"2\"}\n//                 height={tableHeight}\n//                 onRowClick={handleDrillDown}\n//                 reportHeader={`Phase_3_${heading}_Summary`}\n//                 selectedRowsHandler={selectedRowsHandler}\n//               />\n//             ) : (\n//               <div className=\"text-center py-4 text-muted\">\n//                 No data available for the selected view.\n//               </div>\n//             )}\n//           </>\n//         )}\n\n//         {/* SimpleModal (local) */}\n//         <SimpleModal\n//           show={modalOpen}\n//           title={\n//             modalType === \"scheme\"\n//               ? `Apply Scheme to ${selectedRows.length} item${\n//                   selectedRows.length > 1 ? \"s\" : \"\"\n//                 }`\n//               : modalType === \"display\"\n//               ? `Apply Display to ${selectedRows.length} item${\n//                   selectedRows.length > 1 ? \"s\" : \"\"\n//                 }`\n//               : \"\"\n//           }\n//           size=\"lg\"\n//           onClose={() => {\n//             setModalOpen(false);\n//             setModalType(null);\n//             try {\n//               form.reset(defaultFormValues);\n//             } catch {}\n//           }}\n//           footer={modalFooter}\n//         >\n//           {modalType === \"scheme\"\n//             ? SchemeModalBody\n//             : modalType === \"display\"\n//             ? DisplayModalBody\n//             : null}\n//         </SimpleModal>\n//       </>\n//     </Wrapper>\n//   );\n// };\n\n// export default Pase3DynamicTable;\n\n// import React, { useCallback, useEffect, useMemo, useState } from \"react\";\n// import { useLocation, useNavigate, useParams } from \"react-router-dom\";\n// import Wrapper from \"../../common/uicomponent/wrapper\";\n// import GridTable from \"../../common/component/GridTable\";\n// import { toTitleCase } from \"./helperfunc\";\n// import { useSelector, useDispatch } from \"react-redux\";\n// import CenteredLoader from \"../../common/component/CenteredLoader\";\n// import { FormProvider, useForm } from \"react-hook-form\";\n// import { renderField } from \"../../common/utils/renderField\";\n// import scheme, { display } from \"../../core/json/scheme\";\n// import useSchemeOptions, { Option } from \"./useSchemeOptions\";\n// import { saveScheme } from \"../../redux/phase3Slice\";\n\n// const SimpleModal: React.FC<{\n//   show: boolean;\n//   title: string;\n//   size?: \"sm\" | \"md\" | \"lg\" | \"xl\";\n//   onClose: () => void;\n//   footer?: React.ReactNode;\n//   children?: React.ReactNode;\n// }> = ({ show, title, size = \"md\", onClose, footer, children }) => {\n//   if (!show) return null;\n//   const dlgClass =\n//     size === \"sm\"\n//       ? \"modal-sm\"\n//       : size === \"lg\"\n//       ? \"modal-lg\"\n//       : size === \"xl\"\n//       ? \"modal-xl\"\n//       : \"\";\n//   return (\n//     <div\n//       className=\"modal fade show d-block\"\n//       style={{ backgroundColor: \"rgba(0,0,0,0.5)\" }}\n//       tabIndex={-1}\n//     >\n//       <div className={`modal-dialog ${dlgClass} modal-dialog-centered`}>\n//         <div className=\"modal-content\">\n//           <div className=\"modal-header\">\n//             <h5 className=\"modal-title\">{title}</h5>\n//             <button\n//               type=\"button\"\n//               className=\"btn-close\"\n//               onClick={onClose}\n//               aria-label=\"Close\"\n//             />\n//           </div>\n//           <div className=\"modal-body\">{children}</div>\n//           {footer && <div className=\"modal-footer\">{footer}</div>}\n//         </div>\n//       </div>\n//     </div>\n//   );\n// };\n\n// const Pase3DynamicTable: React.FC = () => {\n//   const { id } = useParams();\n//   const location = useLocation();\n//   const navigate = useNavigate();\n//   const dispatch = useDispatch();\n\n//   const savedSchemes = useSelector((s: any) => s.phase3.savedSchemes ?? []);\n\n//   const selectedDepartment = (location.state as any)?.department ?? \"\";\n//   const selectedBranch = (location.state as any)?.branchCode ?? \"\";\n//   const itemCodeFromState = (location.state as any)?.itemCode ?? \"\";\n\n//   const {\n//     data: detailData = [],\n//     loading,\n//     error,\n//   } = useSelector(\n//     (state: any) =>\n//       state.reportDetail || { data: [], loading: false, error: null }\n//   );\n\n//   const [tableHeight, setTableHeight] = useState(\"550px\");\n//   const { getSchemeTypes, getSchemeGroups } = useSchemeOptions();\n\n//   const [schemeTypes, setSchemeTypes] = useState<Option[]>([]);\n//   const [schemeGroups, setSchemeGroups] = useState<Option[]>([]);\n//   const [loadingTypes, setLoadingTypes] = useState(true);\n//   const [loadingGroups, setLoadingGroups] = useState(false);\n\n//   // selection state for grid\n//   const [selectedRows, setSelectedRows] = useState<any[]>([]);\n//   const selectedRowsHandler = (data: any) => setSelectedRows(data || []);\n\n//   // local modal state (non-redux)\n//   const [modalOpen, setModalOpen] = useState(false);\n//   const [modalType, setModalType] = useState<null | \"scheme\" | \"display\">(null);\n\n//   const form = useForm<any>({\n//     mode: \"onBlur\",\n//     defaultValues: {\n//       startDate: null,\n//       endDate: null,\n//       schemeType: null,\n//       schemeGroup: null,\n//       displayType: null,\n//     },\n//   });\n//   const defaultFormValues = {\n//     startDate: null,\n//     endDate: null,\n//     schemeType: null,\n//     schemeGroup: null,\n//     displayType: null,\n//   };\n\n//   const selectedSchemeType = form.watch(\"schemeType\");\n\n//   // load types on mount\n//   useEffect(() => {\n//     let mounted = true;\n//     const load = async () => {\n//       setLoadingTypes(true);\n//       try {\n//         const res = await getSchemeTypes();\n//         if (mounted && res?.status === \"ok\") setSchemeTypes(res.data || []);\n//       } catch (e) {\n//         console.error(\"getSchemeTypes\", e);\n//       } finally {\n//         if (mounted) setLoadingTypes(false);\n//       }\n//     };\n//     load();\n//     return () => {\n//       mounted = false;\n//     };\n//   }, [getSchemeTypes]);\n\n//   useEffect(() => {\n//     if (!selectedSchemeType) {\n//       setSchemeGroups([]);\n//       try {\n//         form.setValue(\"schemeGroup\", null);\n//       } catch {}\n//       return;\n//     }\n//     let mounted = true;\n//     const load = async () => {\n//       setLoadingGroups(true);\n//       try {\n//         const value = selectedSchemeType.value;\n//         const res = await getSchemeGroups(value);\n//         if (mounted && res?.status === \"ok\") setSchemeGroups(res.data || []);\n//       } catch (e) {\n//         console.error(\"getSchemeGroups\", e);\n//         if (mounted) setSchemeGroups([]);\n//       } finally {\n//         if (mounted) setLoadingGroups(false);\n//         try {\n//           form.setValue(\"schemeGroup\", null);\n//         } catch {}\n//       }\n//     };\n//     load();\n//     return () => {\n//       mounted = false;\n//     };\n//   }, [selectedSchemeType, getSchemeGroups, form]);\n\n//   const selectOptions = useMemo(\n//     () => ({\n//       schemeType: schemeTypes,\n//       schemeGroup: schemeGroups,\n//       displayType: [\n//         { value: \"Send Shelf Picture\", label: \"Send Shelf Picture\" },\n//       ],\n//     }),\n//     [schemeTypes, schemeGroups]\n//   );\n\n//   const renderFieldWrapper = useCallback(\n//     (field: any, key: string) =>\n//       renderField({\n//         field,\n//         form,\n//         options: field.props?.name\n//           ? selectOptions[field.props.name as keyof typeof selectOptions] || []\n//           : [],\n//         key,\n//       }),\n//     [form, selectOptions]\n//   );\n\n//   // helpers\n//   const getItemCodeFromRow = useCallback((row: any): string | undefined => {\n//     if (!row) return undefined;\n//     const raw =\n//       row?.[\"Item Code\"] ??\n//       row?.itemCode ??\n//       row?.ItemCode ??\n//       row?.item_code ??\n//       row?.Item_Code ??\n//       row?.itemcode ??\n//       undefined;\n//     if (raw === undefined || raw === null) return undefined;\n//     const trimmed = String(raw).trim();\n//     return trimmed === \"\" ? undefined : trimmed;\n//   }, []);\n\n//   const getBranchCodeFromRow = useCallback(\n//     (row: any): string | undefined => {\n//       if (selectedBranch && String(selectedBranch).trim() !== \"\") {\n//         return String(selectedBranch).trim();\n//       }\n//       if (!row) return undefined;\n//       const raw =\n//         row?.branchCode ??\n//         row?.Branch_Code ??\n//         row?.BranchCode ??\n//         row?.branch_code ??\n//         row?.branch ??\n//         row?.Branch ??\n//         undefined;\n//       if (raw === undefined || raw === null) return undefined;\n//       const trimmed = String(raw).trim();\n//       return trimmed === \"\" ? undefined : trimmed;\n//     },\n//     [selectedBranch]\n//   );\n\n//   const findSavedEntryForRow = useCallback(\n//     (row: any) => {\n//       const itemCode = getItemCodeFromRow(row);\n//       const branchCode = getBranchCodeFromRow(row);\n//       if (itemCode) {\n//         if (branchCode) {\n//           return savedSchemes.find(\n//             (s: any) =>\n//               String(s.itemCode ?? \"\")\n//                 .trim()\n//                 .toLowerCase() === String(itemCode).trim().toLowerCase() &&\n//               String(s.branchCode ?? \"\")\n//                 .trim()\n//                 .toLowerCase() === String(branchCode).trim().toLowerCase()\n//           );\n//         }\n//         const global = savedSchemes.find(\n//           (s: any) =>\n//             String(s.itemCode ?? \"\")\n//               .trim()\n//               .toLowerCase() === String(itemCode).trim().toLowerCase() &&\n//             (s.branchCode === undefined || s.branchCode === null)\n//         );\n//         return global;\n//       }\n//       try {\n//         const rowJson = JSON.stringify(row || {});\n//         return savedSchemes.find((s: any) => {\n//           try {\n//             return JSON.stringify(s.data) === rowJson;\n//           } catch {\n//             return false;\n//           }\n//         });\n//       } catch {\n//         return undefined;\n//       }\n//     },\n//     [savedSchemes, getItemCodeFromRow, getBranchCodeFromRow]\n//   );\n\n//   // totals\n//   const totals = useMemo(() => {\n//     if (!detailData?.length) {\n//       return {\n//         totalSiteQty: 0,\n//         totalSaleQty: 0,\n//         totalSaleVal: 0,\n//         totalStockValue: 0,\n//       };\n//     }\n//     return detailData.reduce(\n//       (acc: any, row: any) => {\n//         const siteQty = row.total_site_qty ?? row.Site_Qtys ?? 0;\n//         acc.totalSiteQty += typeof siteQty === \"number\" ? siteQty : 0;\n//         const saleQty = row.Total_Sale_Qty ?? row.total_sale_qty ?? 0;\n//         acc.totalSaleQty += typeof saleQty === \"number\" ? saleQty : 0;\n//         const saleVal = row.Total_Sale_Val ?? row.total_sale_val ?? 0;\n//         acc.totalSaleVal += typeof saleVal === \"number\" ? saleVal : 0;\n//         const stockVal =\n//           row.Str_Stk_Sp_Value ??\n//           row.str_stk_sp_value ??\n//           row.total_str_stk_sp_value ??\n//           0;\n//         acc.totalStockValue += typeof stockVal === \"number\" ? stockVal : 0;\n//         return acc;\n//       },\n//       { totalSiteQty: 0, totalSaleQty: 0, totalSaleVal: 0, totalStockValue: 0 }\n//     );\n//   }, [detailData]);\n\n//   // base columns\n//   const baseColumnDefs = useMemo(() => {\n//     if (!detailData?.length) return [];\n//     const first = detailData[0];\n//     const keys = Object.keys(first);\n//     const seen = new Set<string>();\n//     return keys\n//       .filter((k) => {\n//         const lower = k.toLowerCase();\n//         if (\n//           lower.includes(\"item\") &&\n//           (lower.includes(\"code\") || lower.includes(\"name\"))\n//         ) {\n//           if (seen.has(\"item_code\") || seen.has(\"item_name\")) return false;\n//           if (lower.includes(\"code\")) seen.add(\"item_code\");\n//           if (lower.includes(\"name\")) seen.add(\"item_name\");\n//         }\n//         return true;\n//       })\n//       .map((k) => ({\n//         field: k,\n//         headerName: toTitleCase(k),\n//         filter:\n//           typeof first[k] === \"string\"\n//             ? \"agTextColumnFilter\"\n//             : \"agNumberColumnFilter\",\n//         headerClass: \"bg-royal-blue text-white\",\n//         sortable: true,\n//         resizable: true,\n//       }));\n//   }, [detailData]);\n\n//   const handleGridReady = (api: any) => {\n//     console.log(\"grid ready\", api);\n//     setTimeout(() => {\n//       api.selectAll(); // selects all rows where checkboxSelection() = true\n//     }, 300);\n//   };\n//   // displayed columns\n//   const displayedColumnDefs = useMemo(() => {\n//     const cols: any = [...baseColumnDefs];\n\n//     // Always add a left pinned checkbox column for row selection.\n//     // Checkbox is shown/hidden per-row based on whether a saved scheme exists for that row.\n//     const hasCheckboxAlready = cols.some(\n//       (c: any) => c.field === \"__select__\" || c.checkboxSelection\n//     );\n//     if (!hasCheckboxAlready) {\n//       const checkboxCol = {\n//         field: \"__select__\",\n//         headerName: \"\",\n//         width: 48,\n//         pinned: \"left\",\n//         lockPosition: true,\n//         suppressSizeToFit: true,\n//         sortable: false,\n//         filter: false,\n//         resizable: false,\n//         // show checkbox only when the row does NOT have an applied scheme\n//         checkboxSelection: (params: any) => {\n//           try {\n//             const row = params.data;\n//             const saved = findSavedEntryForRow(row);\n//             return !saved?.data?.appliedScheme;\n//           } catch (e) {\n//             return true;\n//           }\n//         },\n//         // enable header checkbox to select/deselect all selectable rows at once\n//         // ag-Grid will only select rows for which checkboxSelection returns true\n//         headerCheckboxSelection: true,\n//         // when true, header checkbox will only select rows currently visible after filtering\n//         headerCheckboxSelectionFilteredOnly: false,\n//         cellRenderer: undefined,\n//       };\n//       cols.unshift(checkboxCol);\n//     }\n\n//     // Per request: removed Scheme and Display columns from the table\n//     return cols;\n//   }, [baseColumnDefs, findSavedEntryForRow]);\n\n//   // responsive height\n//   useEffect(() => {\n//     const calculateTableHeight = () => {\n//       const windowHeight = window.innerHeight;\n//       const windowWidth = window.innerWidth;\n//       const headerHeight = 100;\n//       const footerHeight = 30;\n//       const bottomSpace = 50;\n//       const minHeight = 400;\n//       const tabletMinWidth = 768;\n//       const tabletMaxWidth = 1024;\n//       let calculatedHeight: number;\n\n//       if (windowWidth >= 1200) {\n//         calculatedHeight =\n//           windowHeight - headerHeight - footerHeight - bottomSpace;\n//       } else if (\n//         windowWidth >= tabletMinWidth &&\n//         windowWidth <= tabletMaxWidth\n//       ) {\n//         const tabletAdjustment = windowWidth < 900 ? 150 : 100;\n//         calculatedHeight =\n//           windowHeight - headerHeight - footerHeight - tabletAdjustment;\n//       } else {\n//         calculatedHeight = windowHeight - headerHeight - footerHeight - 100;\n//       }\n\n//       setTableHeight(`${Math.max(calculatedHeight, minHeight)}px`);\n//     };\n\n//     calculateTableHeight();\n//     window.addEventListener(\"resize\", calculateTableHeight);\n//     window.addEventListener(\"orientationchange\", calculateTableHeight);\n//     return () => {\n//       window.removeEventListener(\"resize\", calculateTableHeight);\n//       window.removeEventListener(\"orientationchange\", calculateTableHeight);\n//     };\n//   }, []);\n\n//   // drilldown\n//   const handleDrillDown = (e: any) => {\n//     if (id === \"2\") return;\n//     const code =\n//       e?.data?.Item_Code ?? e?.data?.item_code ?? e?.data?.[\"Item Code\"] ?? \"\";\n//     if (code) navigate(\"/dynamictable/2\", { state: { itemCode: code } });\n//   };\n\n//   const heading = selectedDepartment\n//     ? `Department: ${selectedDepartment}`\n//     : selectedBranch\n//     ? `Branch: ${selectedBranch}`\n//     : `ItemCode: ${itemCodeFromState}`;\n\n//   // --------------------------\n//   // modal save handlers (bulk apply)\n//   // --------------------------\n//   const saveSchemeForSelected = (data: any) => {\n//     const targets = selectedRows.length ? selectedRows : []; // if no selection, nothing happens\n//     targets.forEach((row: any) => {\n//       const existing = findSavedEntryForRow(row);\n//       const existingData = existing?.data ?? {};\n//       const schemeToSave = {\n//         ...(existingData.appliedDisplay\n//           ? { appliedDisplay: existingData.appliedDisplay }\n//           : {}),\n//         appliedScheme: data,\n//       };\n//       dispatch(\n//         saveScheme({\n//           row: {\n//             ...row,\n//             itemCode: getItemCodeFromRow(row),\n//             branchCode: getBranchCodeFromRow(row),\n//           },\n//           scheme: schemeToSave,\n//         })\n//       );\n//     });\n//     setModalOpen(false);\n//     setModalType(null);\n//     try {\n//       form.reset(defaultFormValues);\n//     } catch {}\n//   };\n\n//   const saveDisplayForSelected = (data: any) => {\n//     const targets = selectedRows.length ? selectedRows : [];\n//     targets.forEach((row: any) => {\n//       const existing = findSavedEntryForRow(row);\n//       const existingData = existing?.data ?? {};\n//       const schemeToSave = {\n//         ...(existingData.appliedScheme\n//           ? { appliedScheme: existingData.appliedScheme }\n//           : {}),\n//         appliedDisplay: data,\n//       };\n//       dispatch(\n//         saveScheme({\n//           row: {\n//             ...row,\n//             itemCode: getItemCodeFromRow(row),\n//             branchCode: getBranchCodeFromRow(row),\n//           },\n//           scheme: schemeToSave,\n//         })\n//       );\n//     });\n//     setModalOpen(false);\n//     setModalType(null);\n//     try {\n//       form.reset(defaultFormValues);\n//     } catch {}\n//   };\n\n//   // bulk open handlers (above table)\n//   const openApplySchemeBulk = () => {\n//     if (!selectedRows.length) return;\n//     const preset =\n//       selectedRows.length === 1\n//         ? findSavedEntryForRow(selectedRows[0])?.data?.appliedScheme ?? null\n//         : null;\n//     setModalType(\"scheme\");\n//     try {\n//       form.reset(defaultFormValues);\n//       if (preset) form.reset(preset);\n//     } catch {}\n//     setModalOpen(true);\n//   };\n\n//   const openApplyDisplayBulk = () => {\n//     if (!selectedRows.length) return;\n//     const preset =\n//       selectedRows.length === 1\n//         ? findSavedEntryForRow(selectedRows[0])?.data?.appliedDisplay ?? null\n//         : null;\n//     setModalType(\"display\");\n//     try {\n//       form.reset(defaultFormValues);\n//       if (preset) form.reset(preset);\n//     } catch {}\n//     setModalOpen(true);\n//   };\n\n//   const SchemeModalBody = (\n//     <FormProvider {...form}>\n//       <form onSubmit={form.handleSubmit(saveSchemeForSelected)}>\n//         <div className=\"mb-3 small text-muted\">\n//           Applying scheme to {selectedRows.length} selected row\n//           {selectedRows.length > 1 ? \"s\" : \"\"}.\n//         </div>\n//         <div className=\"row\">\n//           {Object.entries(scheme.properties).map(([key, field]) => (\n//             <div key={key} className=\"col-lg-6 col-md-6 mb-3\">\n//               {renderFieldWrapper(field as any, key)}\n//             </div>\n//           ))}\n//         </div>\n//       </form>\n//     </FormProvider>\n//   );\n\n//   const DisplayModalBody = (\n//     <FormProvider {...form}>\n//       <form onSubmit={form.handleSubmit(saveDisplayForSelected)}>\n//         <div className=\"mb-3 small text-muted\">\n//           Applying display to {selectedRows.length} selected row\n//           {selectedRows.length > 1 ? \"s\" : \"\"}.\n//         </div>\n//         <div className=\"row\">\n//           {Object.entries(display.properties).map(([key, field]) => (\n//             <div key={key} className=\"col-lg-12 col-md-12 mb-3\">\n//               {renderFieldWrapper(field as any, key)}\n//             </div>\n//           ))}\n//         </div>\n//       </form>\n//     </FormProvider>\n//   );\n\n//   const modalFooter =\n//     modalType === \"scheme\" ? (\n//       <>\n//         <button\n//           type=\"button\"\n//           className=\"btn btn-secondary\"\n//           onClick={() => {\n//             setModalOpen(false);\n//             setModalType(null);\n//             try {\n//               form.reset(defaultFormValues);\n//             } catch {}\n//           }}\n//         >\n//           Close\n//         </button>\n//         <button\n//           type=\"button\"\n//           className=\"btn btn-primary\"\n//           onClick={() => form.handleSubmit(saveSchemeForSelected)()}\n//         >\n//           Save\n//         </button>\n//       </>\n//     ) : modalType === \"display\" ? (\n//       <>\n//         <button\n//           type=\"button\"\n//           className=\"btn btn-secondary\"\n//           onClick={() => {\n//             setModalOpen(false);\n//             setModalType(null);\n//             try {\n//               form.reset(defaultFormValues);\n//             } catch {}\n//           }}\n//         >\n//           Close\n//         </button>\n//         <button\n//           type=\"button\"\n//           className=\"btn btn-primary\"\n//           onClick={() => form.handleSubmit(saveDisplayForSelected)()}\n//         >\n//           Save\n//         </button>\n//       </>\n//     ) : null;\n\n//   // render\n//   return (\n//     <Wrapper\n//       header={`Phase 3 – ${heading}`}\n//       subHeader=\"Detail Report\"\n//       ExportR={1}\n//       backButtonName=\"Back\"\n//     >\n//       <>\n//         {loading && <CenteredLoader />}\n//         {error && <div className=\"alert alert-danger\">{error}</div>}\n\n//         {!loading && !error && (\n//           <>\n//             {/* Top bulk controls only for item-level (id===2) */}\n//             {id === \"2\" && (\n//               <div className=\"d-flex gap-2 mb-2 align-items-center\">\n//                 <div className=\"small text-muted me-2\">\n//                   Selected: <strong>{selectedRows.length}</strong>\n//                 </div>\n//                 <button\n//                   type=\"button\"\n//                   className=\"btn btn-sm btn-outline-primary\"\n//                   disabled={selectedRows.length === 0}\n//                   onClick={openApplySchemeBulk}\n//                 >\n//                   Apply Scheme\n//                 </button>\n//                 <button\n//                   type=\"button\"\n//                   className=\"btn btn-sm btn-outline-secondary\"\n//                   disabled={selectedRows.length === 0}\n//                   onClick={openApplyDisplayBulk}\n//                 >\n//                   Apply Display\n//                 </button>\n//               </div>\n//             )}\n\n//             {/* Summary Badges */}\n//             {detailData.length > 0 && (\n//               <div className=\"d-flex flex-wrap gap-2 mb-1 align-items-center\">\n//                 {Object.entries({\n//                   \"Site Qty\": totals.totalSiteQty,\n//                   \"Sale Qty\": totals.totalSaleQty,\n//                   \"Sale Value\": totals.totalSaleVal,\n//                   \"Sp Value\": totals.totalStockValue,\n//                 }).map(([label, value]) => {\n//                   const cleanValue = Math.floor(Number(value));\n//                   const displayValue = cleanValue.toLocaleString(\"en-IN\");\n//                   return (\n//                     <span\n//                       key={label}\n//                       className=\"badge bg-light text-dark border px-3 py-2 fw-medium\"\n//                       style={{ fontSize: \"0.875rem\" }}\n//                       title={label}\n//                     >\n//                       <strong>{label}:</strong> {displayValue}\n//                     </span>\n//                   );\n//                 })}\n//               </div>\n//             )}\n\n//             {/* Table */}\n//             {detailData.length > 0 ? (\n//               <GridTable\n//                 rowData={detailData}\n//                 columnDefs={displayedColumnDefs}\n//                 enableEditing={false}\n//                 enableSelection={true} // enable selection so checkbox column works\n//                 height={tableHeight}\n//                 onRowClick={handleDrillDown}\n//                 reportHeader={`Phase_3_${heading}_Summary`}\n//                 selectedRowsHandler={selectedRowsHandler}\n//                 onGridReady={handleGridReady}\n//               />\n//             ) : (\n//               <div className=\"text-center py-4 text-muted\">\n//                 No data available for the selected view.\n//               </div>\n//             )}\n//           </>\n//         )}\n\n//         {/* SimpleModal (local) */}\n//         <SimpleModal\n//           show={modalOpen}\n//           title={\n//             modalType === \"scheme\"\n//               ? `Apply Scheme to ${selectedRows.length} item${\n//                   selectedRows.length > 1 ? \"s\" : \"\"\n//                 }`\n//               : modalType === \"display\"\n//               ? `Apply Display to ${selectedRows.length} item${\n//                   selectedRows.length > 1 ? \"s\" : \"\"\n//                 }`\n//               : \"\"\n//           }\n//           size=\"lg\"\n//           onClose={() => {\n//             setModalOpen(false);\n//             setModalType(null);\n//             try {\n//               form.reset(defaultFormValues);\n//             } catch {}\n//           }}\n//           footer={modalFooter}\n//         >\n//           {modalType === \"scheme\"\n//             ? SchemeModalBody\n//             : modalType === \"display\"\n//             ? DisplayModalBody\n//             : null}\n//         </SimpleModal>\n//       </>\n//     </Wrapper>\n//   );\n// };\n\n// export default Pase3DynamicTable;\n\nimport React, { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { useLocation, useNavigate, useParams } from \"react-router-dom\";\nimport Wrapper from \"../../common/uicomponent/wrapper\";\nimport GridTable from \"../../common/component/GridTable\";\nimport { toTitleCase } from \"./helperfunc\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport CenteredLoader from \"../../common/component/CenteredLoader\";\nimport { FormProvider, useForm } from \"react-hook-form\";\nimport { renderField } from \"../../common/utils/renderField\";\nimport scheme, { display } from \"../../core/json/scheme\";\nimport useSchemeOptions, { Option } from \"./useSchemeOptions\";\nimport { saveScheme } from \"../../redux/phase3Slice\";\n\nconst SimpleModal: React.FC<{\n  show: boolean;\n  title: string;\n  size?: \"sm\" | \"md\" | \"lg\" | \"xl\";\n  onClose: () => void;\n  footer?: React.ReactNode;\n  children?: React.ReactNode;\n}> = ({ show, title, size = \"md\", onClose, footer, children }) => {\n  if (!show) return null;\n  const dlgClass =\n    size === \"sm\"\n      ? \"modal-sm\"\n      : size === \"lg\"\n      ? \"modal-lg\"\n      : size === \"xl\"\n      ? \"modal-xl\"\n      : \"\";\n  return (\n    <div\n      className=\"modal fade show d-block\"\n      style={{ backgroundColor: \"rgba(0,0,0,0.5)\" }}\n      tabIndex={-1}\n    >\n      <div className={`modal-dialog ${dlgClass} modal-dialog-centered`}>\n        <div className=\"modal-content\">\n          <div className=\"modal-header\">\n            <h5 className=\"modal-title\">{title}</h5>\n            <button\n              type=\"button\"\n              className=\"btn-close\"\n              onClick={onClose}\n              aria-label=\"Close\"\n            />\n          </div>\n          <div className=\"modal-body\">{children}</div>\n          {footer && <div className=\"modal-footer\">{footer}</div>}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst Pase3DynamicTable: React.FC = () => {\n  const { id } = useParams();\n  const location = useLocation();\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n\n  const savedSchemes = useSelector((s: any) => s.phase3.savedSchemes ?? []);\n\n  const selectedDepartment = (location.state as any)?.department ?? \"\";\n  const selectedBranch = (location.state as any)?.branchCode ?? \"\";\n  const itemCodeFromState = (location.state as any)?.itemCode ?? \"\";\n\n  const {\n    data: detailData = [],\n    loading,\n    error,\n  } = useSelector(\n    (state: any) =>\n      state.reportDetail || { data: [], loading: false, error: null }\n  );\n\n  const [tableHeight, setTableHeight] = useState(\"550px\");\n  const { getSchemeTypes, getSchemeGroups } = useSchemeOptions();\n\n  const [schemeTypes, setSchemeTypes] = useState<Option[]>([]);\n  const [schemeGroups, setSchemeGroups] = useState<Option[]>([]);\n  // const [loadingTypes, setLoadingTypes] = useState(true);\n  // const [loadingGroups, setLoadingGroups] = useState(false);\n\n  // selection state for grid\n  const [selectedRows, setSelectedRows] = useState<any[]>([]);\n  const selectedRowsHandler = (data: any) => setSelectedRows(data || []);\n\n  // local modal state (non-redux)\n  const [modalOpen, setModalOpen] = useState(false);\n  const [modalType, setModalType] = useState<null | \"scheme\" | \"display\">(null);\n\n  const form = useForm<any>({\n    mode: \"onBlur\",\n    defaultValues: {\n      startDate: null,\n      endDate: null,\n      schemeType: null,\n      schemeGroup: null,\n      displayType: null,\n    },\n  });\n  const defaultFormValues = {\n    startDate: null,\n    endDate: null,\n    schemeType: null,\n    schemeGroup: null,\n    displayType: null,\n  };\n\n  const selectedSchemeType = form.watch(\"schemeType\");\n\n  // load types on mount\n  useEffect(() => {\n    let mounted = true;\n    const load = async () => {\n      // setLoadingTypes(true);\n      try {\n        const res = await getSchemeTypes();\n        if (mounted && res?.status === \"ok\") setSchemeTypes(res.data || []);\n      } catch (e) {\n        console.error(\"getSchemeTypes\", e);\n      } \n      // finally {\n      //   if (mounted) setLoadingTypes(false);\n      // }\n    };\n    load();\n    return () => {\n      mounted = false;\n    };\n  }, [getSchemeTypes]);\n\n  useEffect(() => {\n    if (!selectedSchemeType) {\n      setSchemeGroups([]);\n      try {\n        form.setValue(\"schemeGroup\", null);\n      } catch {}\n      return;\n    }\n    let mounted = true;\n    const load = async () => {\n      // setLoadingGroups(true);\n      try {\n        const value = selectedSchemeType.value;\n        const res = await getSchemeGroups(value);\n        if (mounted && res?.status === \"ok\") setSchemeGroups(res.data || []);\n      } catch (e) {\n        console.error(\"getSchemeGroups\", e);\n        if (mounted) setSchemeGroups([]);\n      } \n      // finally {\n      //   if (mounted) setLoadingGroups(false);\n      //   try {\n      //     form.setValue(\"schemeGroup\", null);\n      //   } catch {}\n      // }\n    };\n    load();\n    return () => {\n      mounted = false;\n    };\n  }, [selectedSchemeType, getSchemeGroups, form]);\n\n  const selectOptions = useMemo(\n    () => ({\n      schemeType: schemeTypes,\n      schemeGroup: schemeGroups,\n      displayType: [\n        { value: \"Send Shelf Picture\", label: \"Send Shelf Picture\" },\n      ],\n    }),\n    [schemeTypes, schemeGroups]\n  );\n\n  const renderFieldWrapper = useCallback(\n    (field: any, key: string) =>\n      renderField({\n        field,\n        form,\n        options: field.props?.name\n          ? selectOptions[field.props.name as keyof typeof selectOptions] || []\n          : [],\n        key,\n      }),\n    [form, selectOptions]\n  );\n\n  // helpers\n  const getItemCodeFromRow = useCallback((row: any): string | undefined => {\n    if (!row) return undefined;\n    const raw =\n      row?.[\"Item Code\"] ??\n      row?.itemCode ??\n      row?.ItemCode ??\n      row?.item_code ??\n      row?.Item_Code ??\n      row?.itemcode ??\n      undefined;\n    if (raw === undefined || raw === null) return undefined;\n    const trimmed = String(raw).trim();\n    return trimmed === \"\" ? undefined : trimmed;\n  }, []);\n\n  const getBranchCodeFromRow = useCallback(\n    (row: any): string | undefined => {\n      if (selectedBranch && String(selectedBranch).trim() !== \"\") {\n        return String(selectedBranch).trim();\n      }\n      if (!row) return undefined;\n      const raw =\n        row?.branchCode ??\n        row?.Branch_Code ??\n        row?.BranchCode ??\n        row?.branch_code ??\n        row?.branch ??\n        row?.Branch ??\n        undefined;\n      if (raw === undefined || raw === null) return undefined;\n      const trimmed = String(raw).trim();\n      return trimmed === \"\" ? undefined : trimmed;\n    },\n    [selectedBranch]\n  );\n\n  const findSavedEntryForRow = useCallback(\n    (row: any) => {\n      const itemCode = getItemCodeFromRow(row);\n      const branchCode = getBranchCodeFromRow(row);\n      if (itemCode) {\n        if (branchCode) {\n          return savedSchemes.find(\n            (s: any) =>\n              String(s.itemCode ?? \"\")\n                .trim()\n                .toLowerCase() === String(itemCode).trim().toLowerCase() &&\n              String(s.branchCode ?? \"\")\n                .trim()\n                .toLowerCase() === String(branchCode).trim().toLowerCase()\n          );\n        }\n        const global = savedSchemes.find(\n          (s: any) =>\n            String(s.itemCode ?? \"\")\n              .trim()\n              .toLowerCase() === String(itemCode).trim().toLowerCase() &&\n            (s.branchCode === undefined || s.branchCode === null)\n        );\n        return global;\n      }\n      try {\n        const rowJson = JSON.stringify(row || {});\n        return savedSchemes.find((s: any) => {\n          try {\n            return JSON.stringify(s.data) === rowJson;\n          } catch {\n            return false;\n          }\n        });\n      } catch {\n        return undefined;\n      }\n    },\n    [savedSchemes, getItemCodeFromRow, getBranchCodeFromRow]\n  );\n\n  // totals\n  const totals = useMemo(() => {\n    if (!detailData?.length) {\n      return {\n        totalSiteQty: 0,\n        totalSaleQty: 0,\n        totalSaleVal: 0,\n        totalStockValue: 0,\n        // totalBBStock:0,\n        // totalPoQty:0\n      };\n    }\n    return detailData.reduce(\n      (acc: any, row: any) => {\n        const siteQty = row.total_site_qty ?? row.Site_Qtys ?? 0;\n        acc.totalSiteQty += typeof siteQty === \"number\" ? siteQty : 0;\n        const saleQty = row.Total_Sale_Qty ?? row.total_sale_qty ?? 0;\n        acc.totalSaleQty += typeof saleQty === \"number\" ? saleQty : 0;\n        const saleVal = row.Total_Sale_Val ?? row.total_sale_val ?? 0;\n        acc.totalSaleVal += typeof saleVal === \"number\" ? saleVal : 0;\n        const stockVal =\n          row.Str_Stk_Sp_Value ??\n          row.str_stk_sp_value ??\n          row.total_str_stk_sp_value ??\n          0;\n        acc.totalStockValue += typeof stockVal === \"number\" ? stockVal : 0;\n        //  const bbstock = row.balance_bin_stock ?? row[\"Balance Bin Stock\"]?? 0;\n        // acc.totalBBStock += typeof bbstock === \"number\" ? bbstock : 0;\n        //  const poQty = row.po_qty ?? row[\"Po Qty\"]?? 0;\n        // acc.totalPoQty += typeof poQty === \"number\" ? poQty : 0;\n        return acc;\n      },\n      { totalSiteQty: 0, totalSaleQty: 0, totalSaleVal: 0, totalStockValue: 0 , totalBBStock:0, totalPoQty:0}\n    );\n  }, [detailData]);\n\n  // base columns\n  const baseColumnDefs = useMemo(() => {\n    if (!detailData?.length) return [];\n    const first = detailData[0];\n    const keys = Object.keys(first);\n    const seen = new Set<string>();\n    return keys\n      .filter((k) => {\n        const lower = k.toLowerCase();\n        if (\n          lower.includes(\"item\") &&\n          (lower.includes(\"code\") || lower.includes(\"name\"))\n        ) {\n          if (seen.has(\"item_code\") || seen.has(\"item_name\")) return false;\n          if (lower.includes(\"code\")) seen.add(\"item_code\");\n          if (lower.includes(\"name\")) seen.add(\"item_name\");\n        }\n        return true;\n      })\n      .map((k) => ({\n        field: k,\n        headerName: toTitleCase(k),\n        filter:\n          typeof first[k] === \"string\"\n            ? \"agTextColumnFilter\"\n            : \"agNumberColumnFilter\",\n        headerClass: \"bg-royal-blue text-white\",\n        sortable: true,\n        resizable: true,\n      }));\n  }, [detailData]);\n\n  // called when grid is ready (GridTable should call this with api)\n  const handleGridReady = (api: any) => {\n    // only auto-select when we're in item view (id === \"2\")\n    if (id === \"2\") {\n      // slight delay to allow ag-grid internal setup; adjust if necessary\n      setTimeout(() => {\n        try {\n          api.selectAll(); // will only select rows allowed by checkboxSelection\n        } catch (e) {\n          // swallow errors silently\n        }\n      }, 200);\n    }\n  };\n\n  // displayed columns\n  const displayedColumnDefs = useMemo(() => {\n    const cols: any = [...baseColumnDefs];\n\n    // Add checkbox column ONLY when id === \"2\"\n    if (id === \"2\") {\n      const hasCheckboxAlready = cols.some(\n        (c: any) => c.field === \"__select__\" || c.checkboxSelection\n      );\n      if (!hasCheckboxAlready) {\n        const checkboxCol = {\n          field: \"__select__\",\n          headerName: \"\",\n          width: 48,\n          pinned: \"left\",\n          lockPosition: true,\n          suppressSizeToFit: true,\n          sortable: false,\n          filter: false,\n          resizable: false,\n          // show checkbox only when the row does NOT have an applied scheme\n          checkboxSelection: (params: any) => {\n            try {\n              const row = params.data;\n              const saved = findSavedEntryForRow(row);\n              return !saved?.data?.appliedScheme;\n            } catch (e) {\n              return true;\n            }\n          },\n          // enable header checkbox to select/deselect all selectable rows at once\n          headerCheckboxSelection: true,\n          headerCheckboxSelectionFilteredOnly: false,\n          cellRenderer: undefined,\n        };\n        cols.unshift(checkboxCol);\n      }\n    }\n\n    // Per request: removed Scheme and Display columns from the table\n    return cols;\n  }, [baseColumnDefs, findSavedEntryForRow, id]);\n\n  // responsive height\n  useEffect(() => {\n    const calculateTableHeight = () => {\n      const windowHeight = window.innerHeight;\n      const windowWidth = window.innerWidth;\n      const headerHeight = 100;\n      const footerHeight = 30;\n      const bottomSpace = 50;\n      const minHeight = 400;\n      const tabletMinWidth = 768;\n      const tabletMaxWidth = 1024;\n      let calculatedHeight: number;\n\n      if (windowWidth >= 1200) {\n        calculatedHeight =\n          windowHeight - headerHeight - footerHeight - bottomSpace;\n      } else if (\n        windowWidth >= tabletMinWidth &&\n        windowWidth <= tabletMaxWidth\n      ) {\n        const tabletAdjustment = windowWidth < 900 ? 150 : 100;\n        calculatedHeight =\n          windowHeight - headerHeight - footerHeight - tabletAdjustment;\n      } else {\n        calculatedHeight = windowHeight - headerHeight - footerHeight - 100;\n      }\n\n      setTableHeight(`${Math.max(calculatedHeight, minHeight)}px`);\n    };\n\n    calculateTableHeight();\n    window.addEventListener(\"resize\", calculateTableHeight);\n    window.addEventListener(\"orientationchange\", calculateTableHeight);\n    return () => {\n      window.removeEventListener(\"resize\", calculateTableHeight);\n      window.removeEventListener(\"orientationchange\", calculateTableHeight);\n    };\n  }, []);\n\n  // drilldown\n  const handleDrillDown = (e: any) => {\n    if (id === \"2\") return;\n    const code =\n      e?.data?.Item_Code ?? e?.data?.item_code ?? e?.data?.[\"Item Code\"] ?? \"\";\n    if (code) navigate(\"/dynamictable/2\", { state: { itemCode: code } });\n  };\n\n  const heading = selectedDepartment\n    ? `Department: ${selectedDepartment}`\n    : selectedBranch\n    ? `Branch: ${selectedBranch}`\n    : `ItemCode: ${itemCodeFromState}`;\n\n  // --------------------------\n  // modal save handlers (bulk apply)\n  // --------------------------\n  const saveSchemeForSelected = (data: any) => {\n    const targets = selectedRows.length ? selectedRows : []; // if no selection, nothing happens\n    targets.forEach((row: any) => {\n      const existing = findSavedEntryForRow(row);\n      const existingData = existing?.data ?? {};\n      const schemeToSave = {\n        ...(existingData.appliedDisplay\n          ? { appliedDisplay: existingData.appliedDisplay }\n          : {}),\n        appliedScheme: data,\n      };\n      dispatch(\n        saveScheme({\n          row: {\n            ...row,\n            itemCode: getItemCodeFromRow(row),\n            branchCode: getBranchCodeFromRow(row),\n          },\n          scheme: schemeToSave,\n        })\n      );\n    });\n    setModalOpen(false);\n    setModalType(null);\n    try {\n      form.reset(defaultFormValues);\n    } catch {}\n  };\n\n  const saveDisplayForSelected = (data: any) => {\n    const targets = selectedRows.length ? selectedRows : [];\n    targets.forEach((row: any) => {\n      const existing = findSavedEntryForRow(row);\n      const existingData = existing?.data ?? {};\n      const schemeToSave = {\n        ...(existingData.appliedScheme\n          ? { appliedScheme: existingData.appliedScheme }\n          : {}),\n        appliedDisplay: data,\n      };\n      dispatch(\n        saveScheme({\n          row: {\n            ...row,\n            itemCode: getItemCodeFromRow(row),\n            branchCode: getBranchCodeFromRow(row),\n          },\n          scheme: schemeToSave,\n        })\n      );\n    });\n    setModalOpen(false);\n    setModalType(null);\n    try {\n      form.reset(defaultFormValues);\n    } catch {}\n  };\n\n  // bulk open handlers (above table)\n  const openApplySchemeBulk = () => {\n    if (!selectedRows.length) return;\n    const preset =\n      selectedRows.length === 1\n        ? findSavedEntryForRow(selectedRows[0])?.data?.appliedScheme ?? null\n        : null;\n    setModalType(\"scheme\");\n    try {\n      form.reset(defaultFormValues);\n      if (preset) form.reset(preset);\n    } catch {}\n    setModalOpen(true);\n  };\n\n  const openApplyDisplayBulk = () => {\n    if (!selectedRows.length) return;\n    const preset =\n      selectedRows.length === 1\n        ? findSavedEntryForRow(selectedRows[0])?.data?.appliedDisplay ?? null\n        : null;\n    setModalType(\"display\");\n    try {\n      form.reset(defaultFormValues);\n      if (preset) form.reset(preset);\n    } catch {}\n    setModalOpen(true);\n  };\n\n  const SchemeModalBody = (\n    <FormProvider {...form}>\n      <form onSubmit={form.handleSubmit(saveSchemeForSelected)}>\n        <div className=\"mb-3 small text-muted\">\n          Applying scheme to {selectedRows.length} selected row\n          {selectedRows.length > 1 ? \"s\" : \"\"}.\n        </div>\n        <div className=\"row\">\n          {Object.entries(scheme.properties).map(([key, field]) => (\n            <div key={key} className=\"col-lg-6 col-md-6 mb-3\">\n              {renderFieldWrapper(field as any, key)}\n            </div>\n          ))}\n        </div>\n      </form>\n    </FormProvider>\n  );\n\n  const DisplayModalBody = (\n    <FormProvider {...form}>\n      <form onSubmit={form.handleSubmit(saveDisplayForSelected)}>\n        <div className=\"mb-3 small text-muted\">\n          Applying display to {selectedRows.length} selected row\n          {selectedRows.length > 1 ? \"s\" : \"\"}.\n        </div>\n        <div className=\"row\">\n          {Object.entries(display.properties).map(([key, field]) => (\n            <div key={key} className=\"col-lg-12 col-md-12 mb-3\">\n              {renderFieldWrapper(field as any, key)}\n            </div>\n          ))}\n        </div>\n      </form>\n    </FormProvider>\n  );\n\n  const modalFooter =\n    modalType === \"scheme\" ? (\n      <>\n        <button\n          type=\"button\"\n          className=\"btn btn-secondary\"\n          onClick={() => {\n            setModalOpen(false);\n            setModalType(null);\n            try {\n              form.reset(defaultFormValues);\n            } catch {}\n          }}\n        >\n          Close\n        </button>\n        <button\n          type=\"button\"\n          className=\"btn btn-primary\"\n          onClick={() => form.handleSubmit(saveSchemeForSelected)()}\n        >\n          Save\n        </button>\n      </>\n    ) : modalType === \"display\" ? (\n      <>\n        <button\n          type=\"button\"\n          className=\"btn btn-secondary\"\n          onClick={() => {\n            setModalOpen(false);\n            setModalType(null);\n            try {\n              form.reset(defaultFormValues);\n            } catch {}\n          }}\n        >\n          Close\n        </button>\n        <button\n          type=\"button\"\n          className=\"btn btn-primary\"\n          onClick={() => form.handleSubmit(saveDisplayForSelected)()}\n        >\n          Save\n        </button>\n      </>\n    ) : null;\n\n  // render\n  return (\n    <Wrapper\n      header={`Phase 3 – ${heading}`}\n      subHeader=\"Detail Report\"\n      ExportR={1}\n      backButtonName=\"Back\"\n    >\n      <>\n        {loading && <CenteredLoader />}\n        {error && <div className=\"alert alert-danger\">{error}</div>}\n\n        {!loading && !error && (\n          <>\n            {/* Top bulk controls only for item-level (id===2) */}\n            {id === \"2\" && (\n              <div className=\"d-flex gap-2 mb-2 align-items-center\">\n                <div className=\"small text-muted me-2\">\n                  Selected: <strong>{selectedRows.length}</strong>\n                </div>\n                <button\n                  type=\"button\"\n                  className=\"btn btn-sm btn-outline-primary\"\n                  disabled={selectedRows.length === 0}\n                  onClick={openApplySchemeBulk}\n                >\n                  Apply Scheme\n                </button>\n                <button\n                  type=\"button\"\n                  className=\"btn btn-sm btn-outline-secondary\"\n                  disabled={selectedRows.length === 0}\n                  onClick={openApplyDisplayBulk}\n                >\n                  Apply Display\n                </button>\n              </div>\n            )}\n\n            {/* Summary Badges */}\n            {detailData.length > 0 && (\n              <div className=\"d-flex flex-wrap gap-2 mb-1 align-items-center\">\n                {Object.entries({\n                  \"Site Qty\": totals.totalSiteQty,\n                  \"Sale Qty\": totals.totalSaleQty,\n                  \"Sale Value\": totals.totalSaleVal,\n                  \"Sp Value\": totals.totalStockValue,\n                  // \"Bal Bin Stock\": totals.totalBBStock,\n                  // \"Po Qty\": totals.totalPoQty\n                \n                }).map(([label, value]) => {\n                  const cleanValue = Math.floor(Number(value));\n                  const displayValue = cleanValue.toLocaleString(\"en-IN\");\n                  return (\n                    <span\n                      key={label}\n                      className=\"badge bg-light text-dark border px-3 py-2 fw-medium\"\n                      style={{ fontSize: \"0.875rem\" }}\n                      title={label}\n                    >\n                      <strong>{label}:</strong> {displayValue}\n                    </span>\n                  );\n                })}\n              </div>\n            )}\n\n            {/* Table */}\n            {detailData.length > 0 ? (\n              <GridTable\n                rowData={detailData}\n                columnDefs={displayedColumnDefs}\n                enableEditing={false}\n                enableSelection={id === \"2\"} // only enable selection when id === \"2\"\n                height={tableHeight}\n                onRowClick={handleDrillDown}\n                reportHeader={`Phase_3_${heading}_Summary`}\n                selectedRowsHandler={selectedRowsHandler}\n                onGridReady={handleGridReady}\n              />\n            ) : (\n              <div className=\"text-center py-4 text-muted\">\n                No data available for the selected view.\n              </div>\n            )}\n          </>\n        )}\n\n        {/* SimpleModal (local) */}\n        <SimpleModal\n          show={modalOpen}\n          title={\n            modalType === \"scheme\"\n              ? `Apply Scheme to ${selectedRows.length} item${\n                  selectedRows.length > 1 ? \"s\" : \"\"\n                }`\n              : modalType === \"display\"\n              ? `Apply Display to ${selectedRows.length} item${\n                  selectedRows.length > 1 ? \"s\" : \"\"\n                }`\n              : \"\"\n          }\n          size=\"lg\"\n          onClose={() => {\n            setModalOpen(false);\n            setModalType(null);\n            try {\n              form.reset(defaultFormValues);\n            } catch {}\n          }}\n          footer={modalFooter}\n        >\n          {modalType === \"scheme\"\n            ? SchemeModalBody\n            : modalType === \"display\"\n            ? DisplayModalBody\n            : null}\n        </SimpleModal>\n      </>\n    </Wrapper>\n  );\n};\n\nexport default Pase3DynamicTable;\n"],"names":["useSchemeOptions","fetcher","useFetch","getSchemeTypes","useCallback","async","got","getSchemeGroups","schemeTypeId","SimpleModal","show","title","size","onClose","footer","children","dlgClass","jsx","className","style","backgroundColor","tabIndex","jsxs","type","onClick","Pase3DynamicTable","id","useParams","location","useLocation","navigate","useNavigate","dispatch","useDispatch","savedSchemes","useSelector","s","phase3","selectedDepartment","_a","state","department","selectedBranch","_b","branchCode","itemCodeFromState","_c","itemCode","data","detailData","loading","error","reportDetail","tableHeight","setTableHeight","useState","schemeTypes","setSchemeTypes","schemeGroups","setSchemeGroups","selectedRows","setSelectedRows","selectedRowsHandler","modalOpen","setModalOpen","modalType","setModalType","form","useForm","mode","defaultValues","startDate","endDate","schemeType","schemeGroup","displayType","defaultFormValues","selectedSchemeType","watch","useEffect","mounted","load","res","status","e","console","setValue","value","selectOptions","useMemo","label","renderFieldWrapper","field","key","renderField","options","props","name","getItemCodeFromRow","row","raw","ItemCode","item_code","Item_Code","itemcode","trimmed","String","trim","getBranchCodeFromRow","Branch_Code","BranchCode","branch_code","branch","Branch","findSavedEntryForRow","find","toLowerCase","global","rowJson","JSON","stringify","totals","length","reduce","acc","siteQty","total_site_qty","Site_Qtys","totalSiteQty","saleQty","Total_Sale_Qty","total_sale_qty","totalSaleQty","saleVal","Total_Sale_Val","total_sale_val","totalSaleVal","stockVal","Str_Stk_Sp_Value","str_stk_sp_value","total_str_stk_sp_value","totalStockValue","totalBBStock","totalPoQty","baseColumnDefs","first","keys","Object","seen","Set","filter","k","lower","includes","has","add","map","headerName","toTitleCase","headerClass","sortable","resizable","handleGridReady","api","setTimeout","selectAll","displayedColumnDefs","cols","hasCheckboxAlready","some","c","checkboxSelection","checkboxCol","width","pinned","lockPosition","suppressSizeToFit","params","saved","appliedScheme","headerCheckboxSelection","headerCheckboxSelectionFilteredOnly","cellRenderer","unshift","calculateTableHeight","windowHeight","window","innerHeight","windowWidth","innerWidth","headerHeight","footerHeight","bottomSpace","minHeight","tabletMinWidth","tabletMaxWidth","calculatedHeight","tabletAdjustment","Math","max","addEventListener","removeEventListener","handleDrillDown","code","heading","saveSchemeForSelected","targets","forEach","existing","existingData","schemeToSave","appliedDisplay","saveScheme","scheme","reset","saveDisplayForSelected","openApplySchemeBulk","preset","openApplyDisplayBulk","SchemeModalBody","FormProvider","onSubmit","handleSubmit","entries","properties","DisplayModalBody","display","modalFooter","Fragment","Wrapper","header","subHeader","ExportR","backButtonName","CenteredLoader","disabled","cleanValue","floor","Number","displayValue","toLocaleString","fontSize","GridTable","rowData","columnDefs","enableEditing","enableSelection","height","onRowClick","reportHeader","onGridReady"],"mappings":"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"}